parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"L4Ts":[function(require,module,exports) {
module.exports={FPS:60,ANTIALIAS:!1,BACKGROUND:"#000",ORIENTATION:0,WIDTH:360,HEIGHT:640,ORIGINAL_TILE_SIZE:32,TILE_SIZE:64,BOARD_WIDTH:10,BOARD_HEIGHT:5,SCALE:1,init:function(){this.SCALE=this.TILE_SIZE/this.ORIGINAL_TILE_SIZE}};
},{}],"Kok4":[function(require,module,exports) {

},{}],"JxzF":[function(require,module,exports) {
var global = arguments[3];
var n=arguments[3];const t=require("./config");module.exports={area:null,viewport:null,debugHitbox:!1,debugBounds:!1,debugImage:!1},n.px=function(n){return n*t.SCALE},n.dispose=function(n,t){n&&("dispose"in n?n.dispose(t):"__dtor"in n&&n.__dtor())},n.audioContext="AudioContext"in n?new AudioContext:null,n.fetchd=function(n,t){return new Promise((r,e)=>{t||(t={}),"responseType"in t||(t.responseType="arraybuffer");var o=new XMLHttpRequest;for(var u in o.open("GET",n,!0),t)o[u]=t[u];o.onload=function(){r(o.response)},o.onerror=function(){e("Unable to fetch specified resource.")},o.send()})},n.fetchAudioBuffer=function(t){return new Promise((r,e)=>{n.audioContext?fetchd(t).then(n=>audioContext.decodeAudioData(n)).then(n=>r(n)).catch(n=>e(n)):e("AudioContext is not available.")})},n.int=function(n){return~~n},n.bool=function(n){return!0===n||!1===n?n:"true"==n||"false"!=n&&!!n},n.float=function(n){return parseFloat(n)},n.float2=function(n){return~~(100*n)/100},n.float3=function(n){return~~(1e3*n)/1e3},n.float4=function(n){return~~(1e4*n)/1e4},n.rad=function(n){return n*Math.PI/180},n.rand=function(){return int(65536*Math.random())},n.randf=function(){return Math.random()},n.randrf=function(n,t){let r=Math.random();return r*t+(1-r)*n},n.randr=function(n,t){let r=Math.random();return~~(r*t+(1-r)*n)},n.randtf=function(n,t,r){for(var e=[],o=0;o<r;o++)e.push(randrf(n,t));return e},n.hrnow=function(){return~~performance.now()},n.randvar=function(n,t){return function(){return randr(n,t)}},n.randitem=function(n,t,r){return t||(t=0),r||(r=n.length-1),function(){return n[randr(t,r)]}},n.getLineSegmentIntersection=function(n,t,r,e,o,u,i,a){if(n==o&&t==u&&r==i&&e==a)return 0;var f=e-t,c=r-n,d=a-u,s=i-o;if(0==f&&0==d){if(t!=u)return 2;var h=Math.max(n,o);return h>Math.min(r,i)?2:(h-n)/c}if(0==c&&0==s){if(n!=o)return 2;var l=Math.max(t,u);return l>Math.min(e,a)?2:(l-t)/f}if(0==c)return 0>(p=(d*(n-o)+s*(u-t))/(s*f))||p>1?2:0>(m=(n-o)/s)||m>1?2:p;var m,p,M=d*c-s*f;return 0==M?2:0>(m=(f*(o-n)+c*(t-u))/M)||m>1?2:0>(p=(s*m+o-n)/c)||p>1?2:p},n.lineSegmentIntersects=function(n,t,r,e,o,u,i,a){let f=getLineSegmentIntersection(n,t,r,e,o,u,i,a);return f>=0&&f<=1},n.rotatePoint=function(n,t,r){return"object"==Rin.typeOf(n)?{x:t*n.x+r*n.y,y:r*n.x-t*n.y}:{x:t*Math.cos(n)+r*Math.sin(n),y:r*Math.cos(n)-t*Math.sin(n)}},n.stepValue=function(n,t,r,e){return Math.round(e*(n-t)/(r-t))/e*(r-t)+t},n.alignValue=function(n,t){return Math.round(n/t)*t},require("./shims");
},{"./config":"L4Ts","./shims":"Kok4"}],"vOmO":[function(require,module,exports) {
const t=module.exports=function(){this.data=[1,0,0,0,1,0,0,0,1]};t.prototype.toString=function(){return`[${this.data[0]}, ${this.data[1]}, ${this.data[2]}]\n[${this.data[3]}, ${this.data[4]}, ${this.data[5]}]\n[${this.data[6]}, ${this.data[7]}, ${this.data[8]}]\n`},t.prototype.zero=function(){for(var t=0;t<9;t++)this.data[t]=0;return this},t.prototype.set=function(a){if(a instanceof t)for(let t=0;t<9;t++)this.data[t]=a.data[t];else if(a instanceof Array)for(let t=0;t<9;t++)this.data[t]=a[t];else for(let t=0;t<9;t++)this.data[t]=a;return this},t.prototype.identity=function(){for(var t=0;t<9;t++)this.data[t]=3&t?0:1;return this},t.prototype.scalef=function(t){for(var a=0;a<9;a++)this.data[a]*=t;return this},t.prototype.clone=function(){for(var a=new t,d=0;d<9;d++)a.data[d]=this.data[d];return a},t.prototype.append=function(t){var a,d,i,r,s=[0,0,0,0,0,0,0,0,0];for(t.data&&(t=t.data),d=0;d<3;d++)for(a=0;a<3;a++){for(r=0,i=0;i<3;i++)r+=this.data[3*d+i]*t[3*i+a];s[3*d+a]=r}for(a=0;a<9;a++)this.data[a]=s[a];return this},t.prototype.translate=function(t,a){return 0==t&&0==a?this:this.append([1,0,t,0,1,a,0,0,1])},t.prototype.rotate=function(t){return 0==t?this:this.append([Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1])},t.prototype.scale=function(t,a){return 1==t&&1==a?this:this.append([t,0,0,0,a,0,0,0,1])},t.prototype.applyTo=function(t,a){return{x:this.data[0]*t+this.data[1]*a+this.data[2],y:this.data[3]*t+this.data[4]*a+this.data[5]}},t.prototype.transpose=function(){for(var t=[0,0,0,0,0,0,0,0,0],a=0;a<3;a++)for(var d=0;d<3;d++)t[3*a+d]=this.data[3*d+a];for(let i=0;i<9;i++)this.data[i]=t[i];return this},t.prototype.det=function(){return this.data[0]*(this.data[4]*this.data[8]-this.data[5]*this.data[7])-this.data[1]*(this.data[3]*this.data[8]-this.data[5]*this.data[6])+this.data[2]*(this.data[3]*this.data[7]-this.data[4]*this.data[6])},t.prototype.adj=function(){var t=this.transpose(),a=[];return a[0]=t.data[4]*t.data[8]-t.data[5]*t.data[7],a[1]=-(t.data[3]*t.data[8]-t.data[5]*t.data[6]),a[2]=t.data[3]*t.data[7]-t.data[4]*t.data[6],a[3]=-(t.data[1]*t.data[8]-t.data[2]*t.data[7]),a[4]=t.data[0]*t.data[8]-t.data[2]*t.data[6],a[5]=-(t.data[0]*t.data[7]-t.data[1]*t.data[6]),a[6]=t.data[1]*t.data[5]-t.data[2]*t.data[4],a[7]=-(t.data[0]*t.data[5]-t.data[2]*t.data[3]),a[8]=t.data[0]*t.data[4]-t.data[1]*t.data[3],t.data=a,t},t.prototype.inverse=function(){var t=this.det();return t?this.adj().scalef(1/t):null};
},{}],"nZpH":[function(require,module,exports) {
const e={};module.exports.attachTo=function(t,o){if(o||(o=1024),!t.prototype.className)throw new Error("Unable to attach recycler functions to unnamed class.");e[t.prototype.className]=t,t.recyclerPool=[],t.prototype.objectId=0,t.nextObjectId=0,t.createdItems=0,t.restoredItems=0,t.recycledItems=0,t.alloc=function(){var e;return this.recyclerPool.length?(e=this.recyclerPool.pop(),t.restoredItems++):(e=new t,t.createdItems++),"__reinit"in e&&e.__reinit.apply(e,arguments),e.objectId=++this.nextObjectId,this.nextObjectId=1073741823&this.nextObjectId,e},t.prototype.dispose=function(e){0!=this.objectId?("__dtor"in this&&this.__dtor(),t.recycledItems++,this.objectId=0,this.disposeReason=e,t.recyclerPool.length<o&&t.recyclerPool.push(this)):console.error("Already disposed ("+t.prototype.className+"): "+e+" / "+this.disposeReason)}},module.exports.showStats=function(){for(var t in console.group("Recycling Facilities"),e){var o=e[t];console.debug(t+": created="+o.createdItems+", restored="+o.restoredItems+", recycled="+o.recycledItems+", available="+o.recyclerPool.length)}console.groupEnd()};
},{}],"Z3Eu":[function(require,module,exports) {
const t=require("./recycler"),i=module.exports=function(){};i.prototype.className="Rect",i.prototype.cx=0,i.prototype.cy=0,i.prototype.x1=0,i.prototype.y1=0,i.prototype.x2=0,i.prototype.y2=0,i.prototype.__reinit=function(){switch(arguments.length){case 0:this.Rect0.apply(this,arguments);break;case 2:this.Rect2.apply(this,arguments);break;case 4:this.Rect4.apply(this,arguments)}return this},i.prototype.Rect0=function(){this.x1=this.y1=this.x2=this.y2=this.cx=this.cy=0},i.prototype.Rect4=function(t,i,s,h){this.set(t,i,s,h)},i.prototype.Rect2=function(t,i){this.set(0,0,0,0),this.resize(t,i)},i.prototype.clone=function(){return i.alloc(this.x1,this.y1,this.x2,this.y2)},i.prototype.zero=function(){return this.cx=0,this.cy=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this},i.prototype.reset=function(){return this.cx=null,this.cy=null,this.x1=null,this.y1=null,this.x2=null,this.y2=null,this},i.prototype.extendWithPoint2=function(t,i){return(null===this.x1||t<this.x1)&&(this.x1=t),(null===this.y1||i<this.y1)&&(this.y1=i),(null===this.x2||t>this.x2)&&(this.x2=t),(null===this.y2||i>this.y2)&&(this.y2=i),this.cx=(this.x1+this.x2)/2,this.cy=(this.y1+this.y2)/2,this},i.prototype.extendWithPoint1=function(t){return this.extendWithPoint2(t.x,t.y)},i.prototype.translate=function(t,i){return this.x1+=t,this.y1+=i,this.x2+=t,this.y2+=i,this.cx+=t,this.cy+=i,this},i.prototype.centerAt=function(t,i,s=!1){return 1==s&&(t=this.x1+t*(this.x2-this.x1),i=this.y1+i*(this.y2-this.y1)),this.translate(t-this.cx,i-this.cy)},i.prototype.set=function(){switch(arguments.length){case 1:return this.set1.apply(this,arguments);case 4:return this.set4.apply(this,arguments)}},i.prototype.set4=function(t,i,s,h){return this.cx=(t+s)/2,this.cy=(i+h)/2,this.x1=t,this.y1=i,this.x2=s,this.y2=h,this},i.prototype.set1=function(t){return this.set4(t.x1,t.y1,t.x2,t.y2)},i.prototype.equals=function(){switch(arguments.length){case 1:return this.equals1.apply(this,arguments);case 4:return this.equals4.apply(this,arguments)}},i.prototype.equals1=function(t){return this.x1==t.x1&&this.x2==t.x2&&this.y1==t.y1&&this.y2==t.y2},i.prototype.equals4=function(t,i,s,h){return t==this.x1&&s==this.x2&&i==this.y1&&h==this.y2},i.prototype.contains=function(){switch(arguments.length){case 1:return this.contains1.apply(this,arguments);case 4:return this.contains4.apply(this,arguments)}},i.prototype.contains1=function(t){return t.equals(Math.max(this.x1,t.x1),Math.max(this.y1,t.y1),Math.min(this.x2,t.x2),Math.min(this.y2,t.y2))},i.prototype.contains4=function(t,i,s,h){return t==Math.max(this.x1,t)&&i==Math.max(this.y1,i)&&s==Math.min(this.x2,s)&&h==Math.min(this.y2,h)},i.prototype.setAsUnion=function(){switch(arguments.length){case 1:return this.setAsUnion1.apply(this,arguments);case 4:return this.setAsUnion4.apply(this,arguments)}},i.prototype.setAsUnion1=function(t){return this.setAsUnion4(t.x1,t.y1,t.x2,t.y2)},i.prototype.setAsUnion4=function(t,i,s,h){return this.x1=Math.min(this.x1,t),this.y1=Math.min(this.y1,i),this.x2=Math.max(this.x2,s),this.y2=Math.max(this.y2,h),this},i.prototype.intersects=function(){switch(arguments.length){case 1:return this.intersects1.apply(this,arguments);case 4:return this.intersects4.apply(this,arguments)}},i.prototype.intersects1=function(t){return this.intersects4(t.x1,t.y1,t.x2,t.y2)},i.prototype.intersects4=function(t,i,s,h){var e=Math.max(this.x1,t),n=Math.max(this.y1,i),o=Math.min(this.x2,s),r=Math.min(this.y2,h);return Math.max(0,r-n)*Math.max(0,o-e)>0},i.prototype.setAsIntersection=function(){switch(arguments.length){case 1:return this.setAsIntersection1.apply(this,arguments);case 4:return this.setAsIntersection4.apply(this,arguments)}},i.prototype.setAsIntersection1=function(t){return this.setAsIntersection4(t.x1,t.y1,t.x2,t.y2)},i.prototype.setAsIntersection4=function(t,i,s,h){return this.x1=Math.max(this.x1,t),this.y1=Math.max(this.y1,i),this.x2=Math.min(this.x2,s),this.y2=Math.min(this.y2,h),Math.max(0,this.y2-this.y1)*Math.max(0,this.x2-this.x1)>0},i.prototype.resize=function(t,i,s=!1,h=!1){return 1==s&&(t*=this.x2-this.x1,i*=this.y2-this.y1),1==h?(this.x2=this.x1+t,this.y2=this.y1+i):(t/=2,i/=2,this.x1=this.cx-t,this.y1=this.cy-i,this.x2=this.cx+t,this.y2=this.cy+i),this},i.prototype.resizeBy=function(t,i,s=!1){return 1==s?(this.x2+=t,this.y2+=i):(t/=2,i/=2,this.x1-=t,this.y1-=i,this.x2+=t,this.y2+=i),this},i.prototype.width=function(){return this.x2-this.x1},i.prototype.height=function(){return this.y2-this.y1},i.prototype.ncx=function(){return(this.cx-this.x1)/(this.x2-this.x1)},i.prototype.ncy=function(){return(this.cy-this.y1)/(this.y2-this.y1)},i.prototype.isRight=function(){return this.x1<=this.x2&&this.y1<=this.y2},i.prototype.containsPoint=function(t,i,s){return s||(s=0),this.x1-s<=t&&t<=this.x2+s&&this.y1-s<=i&&i<=this.y2+s},i.prototype.area=function(t){return t?this.isRight()?(this.y2-this.y1)*(this.x2-this.x1):0:(this.y2-this.y1)*(this.x2-this.x1)},i.prototype.floor=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.floor(this.x2),this.y2=Math.floor(this.y2),this.cx=Math.floor(this.cx),this.cy=Math.floor(this.cy),this},i.prototype.ceil=function(){return this.x1=Math.ceil(this.x1),this.y1=Math.ceil(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this.cx=Math.ceil(this.cx),this.cy=Math.ceil(this.cy),this},i.prototype.toString=function(){return"(Rect: "+this.x1.toFixed(2)+", "+this.y1.toFixed(2)+", "+this.x2.toFixed(2)+", "+this.y2.toFixed(2)+")"},i.prototype.flatten=function(){return[this.x1,this.y1,this.x2,this.y2]},i.prototype.unflatten=function(t){return this.set(t[0],t[1],t[2],t[3]),this},t.attachTo(i);
},{"./recycler":"nZpH"}],"N2CI":[function(require,module,exports) {
const t=module.exports=function(){switch(arguments.length){case 0:return this.Vec2_0.apply(this,arguments);case 1:return this.Vec2_1.apply(this,arguments);case 2:return this.Vec2_2.apply(this,arguments)}};t.prototype.x=0,t.prototype.y=0,t.prototype.Vec2_0=function(){this.x=this.y=0},t.prototype.Vec2_2=function(t,i){this.x=t,this.y=i},t.prototype.Vec2_1=function(t){this.x=t.x,this.y=t.y},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.set=function(t,i){return 1==arguments.length?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),this},t.prototype.zero=function(){return this.set(0,0)},t.prototype.isZero=function(){return 0==this.x&&0==this.y},t.prototype.equals=function(t,i){return 1==arguments.length?this.x==t.x&&this.y==t.y:this.x==t&&this.y==i},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.inv=function(){return this.x=1/this.x,this.y=1/this.y,this},t.prototype.abs=function(){return this.x=this.x<0?-this.x:this.x,this.y=this.y<0?-this.y:this.y,this},t.prototype.translate=function(t,i){return 1==arguments.length?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=i),this},t.prototype.add=function(t,i){return 1==arguments.length?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=i),this},t.prototype.sub=function(t,i){return 1==arguments.length?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=i),this},t.prototype.scale=function(t,i){return 1==arguments.length?(this.x*=t,this.y*=t):(this.x*=t,this.y*=i),this},t.prototype.floor=function(){return this.x=~~this.x,this.y=~~this.y,this},t.prototype.fract=function(){return this.x=this.x-~~this.x,this.y=this.y-~~this.y,this},t.prototype.dot=function(t,i){return 2==arguments.length?this.x*t+this.y*i:this.x*t.x+this.y*t.y},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.normalize=function(){return this.isZero()?this:this.scale(1/this.magnitude())},t.prototype.majorAxis=function(){return Math.abs(this.x)>Math.abs(this.y)?this.y=0:this.x=0,this},t.prototype.minorAxis=function(){return Math.abs(this.x)<Math.abs(this.y)?this.y=0:this.x=0,this},t.prototype.sign=function(){return this.x=this.x?this.x<0?-1:1:0,this.y=this.y?this.y<0?-1:1:0,this},t.prototype.toString=function(){return`(${this.x}, ${this.y})`};
},{}],"axtM":[function(require,module,exports) {
let e=module.exports={};e.invokeLater=function(e){e&&setTimeout(function(){e()},10)},e.wait=function(e){return new Promise(function(n,r){setTimeout(n,e)})},e.typeOf=function(e){return e instanceof Array?"array":null===e?"null":(typeof e).toString().toLowerCase()},e.isArrayOrObject=function(n){switch(e.typeOf(n)){case"array":case"object":return!0}return!1},e.clone=function(n){var r;if("array"==e.typeOf(n)){r=[];for(let t=0;t<n.length;t++)r.push(e.clone(n[t]))}else if("object"==e.typeOf(n)){r={};for(let t in n)r[t]=e.clone(n[t])}else r=n;return r},e.merge=function(n,...r){if("array"==e.typeOf(n))for(let t=0;t<r.length;t++){let o=r[t];if("array"!=e.typeOf(o))n.push(o);else for(let r=0;r<o.length;r++)n.push(e.clone(o[r]))}else if("object"==e.typeOf(n))for(let t=0;t<r.length;t++){let o=r[t];if("object"==e.typeOf(o))for(let r in o)e.isArrayOrObject(o[r])?r in n?e.merge(n[r],o[r]):n[r]=e.clone(o[r]):n[r]=o[r]}return n},e.override=function(e,...n){for(let r=0;r<n.length;r++)for(let t in n[r])e[t]=n[r][t];return e},e.partialCompare=function(e,n){if(null==e||null==n)return!1;if(e===n)return!0;for(var r in n)if(e[r]!=n[r])return!1;return!0},e.arrayFind=function(e,n,r){for(var t=0;e&&t<e.length;t++)if(this.partialCompare(e[t],n))return r?e[t]:t;return!!r&&null},e.indexOf=function(e,n,r=!1){if(r){for(let r=0;r<e.length;r++)if(e[r]===n)return r;return-1}for(let t in e)if(e[t]===n)return t;return-1},e.escape=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.ensureTypeOf=function(e,n){return!n||!e||n instanceof e?n:n.isInstanceOf&&e.prototype.className&&n.isInstanceOf(e.prototype.className)?n:new e(n)},e.serialize=function(e){return JSON.stringify(e)},e.deserialize=function(e){return JSON.parse(e)},e.hookAppend=function(e,n,r,t=!0){const o=e[n].bind(e);return e[n]=t?(...e)=>{if(!1!==o(...e))return r(...e)}:(...e)=>(o(...e),r(...e)),{unhook:function(){e[n]=o}}},e.hookPrepend=function(e,n,r,t=!0){const o=e[n].bind(e);return e[n]=t?(...e)=>{if(!1!==r(...e))return o(...e)}:(...e)=>(r(...e),o(...e)),{unhook:function(){e[n]=o}}};
},{}],"xPXT":[function(require,module,exports) {
let t=require("./alpha"),e=module.exports=function(){};e._class=e,e._super={},e.prototype.className="Class",e.prototype.__ctor=function(){},e.prototype.__dtor=function(){},e.prototype.isInstanceOf=function(e){return(e="string"==t.typeOf(e)?e:e.prototype?e.prototype.className:e.constructor.prototype.className)in this._super||this.className==e},e.prototype._initSuperRefs=function(){var e=this.constructor._super,s={};for(let r in e){let o={},p=e[r].prototype;for(let e in p)"function"==t.typeOf(p[e])&&(o[e]=p[e].bind(this));s[r]=o}this._super=s},e.inherit=function(e){var s=this._class,r=s._super,o=s._class;if("function"==t.typeOf(e)){for(let t in e._class)/^[A-Z]/.test(t)||(s[t]=e._class[t]);t.override(s.prototype,e._class.prototype),t.override(r,e._class._super),e._class.prototype.className&&(r[e._class.prototype.className]=e._class)}else t.override(s.prototype,e);return s._super=r,s._class=o,s},e.prototype._extend=function(t,s){var r=function(...t){this._initSuperRefs(),this.__ctor.apply(this,t)};r._class=r,r._super={},e.inherit.call(r,t),delete r.prototype.className;for(let e=0;e<s.length;e++)r.inherit(s[e]);return delete r._super.Class,"classInit"in r.prototype&&r.prototype.classInit(),r},e.extend=function(...t){return this._class.prototype._extend(this,t)},e.create=function(t){return new(this.extend(t))};
},{"./alpha":"axtM"}],"K4NB":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];let i=require("./alpha"),s=require("./class");module.exports=s.extend({className:"Event",source:null,name:null,args:null,_async:!1,list:null,next:null,ret:null,original:null,i:-1,__ctor:function(t,i,s,h,n,e){this.source=t,this.name=s,this.args=h,this.cbHandler=n,this.cbContext=e,this.list=i,this.reset()},reset:function(){return this.next=null,this.ret=[],this._async=!1,this.i=-1,this},wait:function(){return this._async=!0,this},resume:function(){for(this._async=!1;!(this._async||++this.i>=this.list.length);)if(!this.list[this.i].silent)if("string"==i.typeOf(this.list[this.i].handler)){if(this.list[this.i].context){if(!this.list[this.i].context[this.list[this.i].handler])continue;if(!1===this.list[this.i].context[this.list[this.i].handler](this,this.args,this.list[this.i].data))break}else if(!1===t[this.list[this.i].handler].call(null,this,this.args,this.list[this.i].data))break}else if(!1===this.list[this.i].handler.call(this.list[this.i].context,this,this.args,this.list[this.i].data))break;return this._async?this:(this.i>=this.list.length&&this.next&&this.next.resume(),this.cbHandler&&this.cbHandler.call(this.cbContext),this)},from:function(t){return this.original=t,this},enqueue:function(t){if(!t)return this;var i;for(i=this;null!=i.next;i=i.next);return i.next=t,t.from(this),this}});
},{"./alpha":"axtM","./class":"xPXT"}],"aK92":[function(require,module,exports) {
let e=require("./class"),t=require("./event");module.exports=e.extend({className:"EventDispatcher",listeners:null,namespace:null,__ctor:function(){this.listeners={}},setNamespace:function(e){return this.namespace=e,this},addEventListener:function(e,t,s,n){var i=(e=e.split(":"))[e.length-1],r=e.length>1?e[0]:null;return this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push({ns:r,handler:t,context:s,data:n,silent:0}),this},removeEventListener:function(e,t,s){var n=(e=e.split(":"))[e.length-1],i=e.length>1?e[0]:null;if("*"==n)for(var r in this.listeners)for(var l=this.listeners[r],h=0;h<l.length;h++){var a=!0;t&&(a=a&&l[h].handler===t),s&&(a=a&&l[h].context===s),i&&(a=a&&l[h].ns==i),a&&l.splice(h--,1)}else{if(!this.listeners[n])return this;for(l=this.listeners[n],h=0;h<l.length;h++){a=!0;t&&(a=a&&l[h].handler===t),s&&(a=a&&l[h].context===s),i&&(a=a&&l[h].ns==i),a&&l.splice(h--,1)}}return this},prepareEvent:function(e,s,n,i){var r=[],l=(e=e.split(":"))[e.length-1],h=e.length>1?e[0]:null;this.listeners[l]&&(r=r.concat(this.listeners[l])),this.listeners["*"]&&(r=r.concat(this.listeners["*"]));for(var a=0;a<r.length;a++)r[a].silent&&r.splice(a--,1);if(h)for(a=0;a<r.length;a++)r[a].ns!=h&&r.splice(a--,1);return new t(this,r,l,s,n,i)},silence:function(e,t){var s=(e=e.split(":"))[e.length-1],n=e.length>1?e[0]:null;if(t=!1===t?-1:1,"*"==s)for(var i in this.listeners)for(var r=this.listeners[i],l=0;l<r.length;l++)n&&r[l].ns!=n||(r[l].silent+=t);else{if(!this.listeners[s])return this;for(r=this.listeners[s],l=0;l<r.length;l++)n&&r[l].ns!=n||(r[l].silent+=t)}return this},dispatchEvent:function(e,t,s,n){return this.prepareEvent(this.namespace?this.namespace+":"+e:e,t,s,n).resume()}});
},{"./class":"xPXT","./event":"K4NB"}],"S8C1":[function(require,module,exports) {
module.exports={email:/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)+$/i,url:/^[\w-]+:\/\/[\w-]+(\.\w+)+.*$/,urlNoProt:/^[\w-]+(\.\w+)+.*$/,name:/^[-A-Za-z0-9_.]+$/,uname:/^['\pL\pN ]+$/,text:/^[^&<>{}]*$/,utext:/^([\r\n\pL\pN\pS &!@#$%*\[\]()_+=;',.\/?:"~-]+)$/};
},{}],"JVzn":[function(require,module,exports) {
let Rin=require("./alpha"),Regex=require("./model-regex");module.exports={_getref:function(value,obj){return"string"==typeof value?("#"==value.substr(0,1)?value=obj.get(value.substr(1)):"@"==value.substr(0,1)&&(value=obj[value.substr(1)]),"string"==typeof value?eval(value):value):value},type:function(r,e,t,n){switch(e){case"int":if(n=parseInt(n),isNaN(n))throw new Error(e);break;case"float":if(n=parseFloat(n),isNaN(n))throw new Error(e);break;case"string":n=null==n?"":n.toString();break;case"bit":if(!0===n||!1===n){n=n?1:0;break}if(n=parseInt(n),isNaN(n))throw new Error(e);n=n?1:0;break;case"array":if("array"==Rin.typeOf(n))break;if(null==n){n=[];break}throw new Error(e);case"bool":if("true"===n||!0===n){n=!0;break}if("false"===n||!1===n){n=!1;break}throw new Error(e)}return n},model:function(r,e,t,n){var o=this._getref(e,r);if(!o)throw new Error(e);return n?o.ensure(n):new o},cls:function(r,e,t,n){var o=this._getref(e,r);return n?Rin.ensureTypeOf(o,n):new o},arrayof:function(r,e,t,n){var o=this._getref(e,r);if(n||(n=[]),!o||"array"!=Rin.typeOf(n))throw new Error(e);for(var i=0;i<n.length;i++)n[i]=Rin.ensureTypeOf(o,n[i]);return n},arraynull:function(r,e,t,n){var o=!1;if("object"==Rin.typeOf(e)&&(e.remove&&(o=e.remove),e=e.value),e)return n;if("array"!=Rin.typeOf(n))throw new Error(e);for(var i=0;i<n.length;i++)if(null==n[i]){if(!o)throw new Error(e);n.splice(i--,1)}return n},arraycompliant:function(r,e,t,n){var o=!1;if("object"==Rin.typeOf(e)&&(e.remove&&(o=e.remove),e=e.value),!e)return n;if("array"!=Rin.typeOf(n))throw new Error(e);for(var i=0;i<n.length;i++)if(null!=n[i]&&!n[i].isCompliant()){if(!o)throw new Error(e);n.splice(i--,1)}return n},required:function(r,e,t,n){if(null==n)throw new Error(e?"":"null");switch(Rin.typeOf(n)){case"array":if(0==n.length)throw new Error(e?"":"null");break;default:if(0==n.toString().length)throw new Error(e?"":"null")}return n},minlen:function(r,e,t,n){if(n.toString().length<e)throw new Error(e);return n},maxlen:function(r,e,t,n){if(n.toString().length>e)throw new Error(e);return n},minval:function(r,e,t,n){if(parseFloat(n)<e)throw new Error(e);return n},maxval:function(r,e,t,n){if(parseFloat(n)>e)throw new Error(e);return n},mincount:function(r,e,t,n){if("array"!=Rin.typeOf(n)||n.length<e)throw new Error(e);return n},maxcount:function(r,e,t,n){if("array"!=Rin.typeOf(n)||n.length>e)throw new Error(e);return n},pattern:function(r,e,t,n){if(!Regex[e].test(n.toString()))throw new Error(e);return n},inset:function(r,e,t,n){if("array"!=Rin.typeOf(e)){if(!new RegExp("^("+e.toString()+")$").test(n.toString()))throw new Error(e);return n}if(-1==e.indexOf(n.toString()))throw new Error(e.join("|"));return n},upper:function(r,e,t,n){return e?n.toString().toUpperCase():n},lower:function(r,e,t,n){return e?n.toString().toLowerCase():n}};
},{"./alpha":"axtM","./model-regex":"S8C1"}],"rbeK":[function(require,module,exports) {
let t=require("./alpha"),i=require("./event-dispatcher"),s=module.exports=i.extend({className:"Model",defaults:null,constraints:null,data:null,changedList:null,_silent:0,_level:0,__ctor:function(t,i){if(this._super.EventDispatcher.__ctor(),this.data={},null!=i)this.reset(i);else{var s=null;if(!this.defaults&&this.constraints){s={};for(var e in this.constraints){var n=this.constraints[e];null!==n.def&&void 0!==n.def?"function"==typeof n.def?s[e]=n.def():s[e]=n.def:s[e]=null}}this.reset(s)}this.init(),null!=t&&this.set(arguments[0],!0),this.constraints&&this.update(),this.ready()},reset:function(i,s){if(!this.defaults){if(!i||"object"!=t.typeOf(i)&&"function"!=t.typeOf(i))return this;this.defaults=i}return"function"==t.typeOf(this.defaults)?this.data=this.defaults():this.data=t.clone(this.defaults),!1===s||!1===i?this:this.update(null,!0)},init:function(){},ready:function(){},silent:function(t){return this._silent+=t?1:-1,this},_validate:function(t,i){if(!this.constraints||!this.constraints[t])return i;var e=this.constraints[t],n=i;for(var a in e)if(s.Constraints[a])try{n=s.Constraints[a](this,e[a],t,n)}catch(r){if("null"==r.message)break;throw new Error(`Constraint [${a}:${e[a]}] failed on property '${t}'.`)}return n},_set:function(t,i){if(!this.constraints||!this.constraints[t])return this.data[t]=i,i;var e=this.constraints[t],n=(this.data[t],i);for(var a in e)if(s.Constraints[a])try{n=s.Constraints[a](this,e[a],t,n)}catch(r){if("null"==r.message)break;this._silent||this.dispatchEvent("constraintError",{constraint:a,message:r.message,name:t,value:i});break}return this.data[t]=n},_propertyEvent:function(t,i,s,e){var n={name:t,old:i,value:s,level:this._level},a=this.dispatchEvent("propertyChanging",n);e?this.data[t]=n.value:n.value=this._set(t,n.value),null!=a&&a.ret.length&&!1===a.ret[0]||(this.dispatchEvent("propertyChanged."+t,n),this.dispatchEvent("propertyChanged",n),this.changedList.push(t))},set:function(){var i=arguments.length,s=!1,e=!1;if((i>2||2==i&&"object"==t.typeOf(arguments[0]))&&"boolean"==t.typeOf(arguments[i-1])&&!1===(s=arguments[--i])&&(e=!0),0==this._level&&(this.changedList=[]),this._level++,2==i)(this.data[arguments[0]]!=arguments[1]||s)&&(this._silent||e?this._set(arguments[0],arguments[1]):this._propertyEvent(arguments[0],this.data[arguments[0]],this._validate(arguments[0],arguments[1])));else for(var n in arguments[0])(this.data[n]!=arguments[0][n]||s)&&(this._silent||e?this._set(n,arguments[0][n]):this._propertyEvent(n,this.data[n],this._validate(n,arguments[0][n])));return--this._level||!this.changedList.length||e||this._silent||this.dispatchEvent("modelChanged",{fields:this.changedList}),this},get:function(t,i){return 0==arguments.length||!1===t?this.data:1==arguments.length&&!0===t?this.flatten():2==arguments.length&&void 0===this.data[t]?i:this.data[t]},getInt:function(t,i){return 2==arguments.length&&void 0===this.data[t]?i:parseInt(this.data[t])},getFloat:function(t,i){return 2==arguments.length&&void 0===this.data[t]?i:parseFloat(this.data[t])},getBool:function(t,i){return"true"===(t=2==arguments.length&&void 0===this.data[t]?i:this.data[t])||!0===t||"false"!==t&&!1!==t&&!!parseInt(t)},getReference:function(t){var i=this;return{get:function(){return i.get(t)},set:function(s){i.set(t,s)}}},constraint:function(i,s,e){if(3==arguments.length||2==arguments.length||1==arguments.length&&"object"==t.typeOf(i)){switch(this.constraints===this.constructor.prototype.constraints&&(this.constraints=t.clone(this.constraints)),arguments.length){case 1:t.override(this.constraints,i);break;case 2:t.override(this.constraints[i],s);break;case 3:this.constraints[i][s]=e}return this}return i?this.constraints[i]:this},flatten:function(i,s){if(i)return null==(a=this.flatten(!1,!0))?null:(a.class=this.classPath,a);if(!this.constraints&&!this.defaults)return this.data;if(!this.isCompliant())return{};var e=this.constraints,n=this.defaults?"function"==t.typeOf(this.defaults)?this.defaults():this.defaults:this.constraints,a={};for(var r in this.data)if(r in n){if(e&&e[r]){var h=e[r];if(h.model){a[r]=this.data[r]?this.data[r].flatten(s):null;continue}if(h.arrayof){a[r]=[];for(var l=0;l<this.data[r].length;l++)a[r][l]=this.data[r][l]?this.data[r][l].flatten(s):null;continue}if(h.cls){a[r]=this.data[r]?this.data[r].flatten():null;continue}}a[r]=this.data[r]}return a},remove:function(i,s){if("array"==t.typeOf(i)){for(var e=0;e<i.length;e++)delete this.data[i[e]];!1===s||this._silent||this.dispatchEvent("propertyRemoved",{fields:i})}else delete this.data[i],!1===s||this._silent||this.dispatchEvent("propertyRemoved",{fields:[i]})},update:function(i,s){if(this._silent)return this;if(0==this._level&&(this.changedList=[]),this._level++,i&&"string"==t.typeOf(i))this._propertyEvent(i,this.data[i],this.data[i],s);else if(i&&"array"==t.typeOf(i))for(var e of i)this._propertyEvent(e,this.data[e],this.data[e],s);else for(var e in this.data)this._propertyEvent(e,this.data[e],this.data[e],s);return--this._level||this._silent||0==this.changedList.length&&!0!==i||this.dispatchEvent("modelChanged",{fields:this.changedList}),this},validate:function(i){if(!this.constraints)return this;if(i&&"string"==t.typeOf(i))this._set(i,this.data[i]);else for(var s in this.data)i&&-1==t.indexOf(i,s)||this._set(s,this.data[s]);return this},isCompliant:function(){if(!this.constraints)return!0;try{for(var t in this.data)this._validate(t,this.data[t]);return!0}catch(i){}return!1},observe:function(t,i,s){this.addEventListener("propertyChanged."+t,i,s)},unobserve:function(t,i,s){this.removeEventListener("propertyChanged."+t,i,s)},toString:function(){return t.serialize(this.get(!0))}});s.Constraints=require("./model-constraints");
},{"./alpha":"axtM","./event-dispatcher":"aK92","./model-constraints":"JVzn"}],"J25A":[function(require,module,exports) {
let e=require("./alpha"),t=require("./model");module.exports=t.extend({className:"List",itemt:t,contents:null,defaults:{contents:null},constraints:{contents:{type:"array",arrayof:"@itemt"}},ready:function(){this._eventGroup="ModelList_"+Date.now()+":modelChanged",this.contents=this.data.contents},_bind:function(e,t){return t&&t.addEventListener&&t.addEventListener(this._eventGroup,this._onItemEvent,this,e),t},_unbind:function(e){return e&&e.removeEventListener&&e.removeEventListener(this._eventGroup),e},_onItemEvent:function(e,t,n){this.prepareEvent("itemChanged",{index:n,item:e.source}).from(e).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},count:function(){return this.data.contents.length},clear:function(){for(var e=0;e<this.data.contents;e++)this._unbind(this.data.contents[e]);this.data.contents=[],this.prepareEvent("itemCleared").enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},setData:function(t){if(this.clear(),t){for(var n=0;n<t.length;n++){var i=e.ensureTypeOf(this.itemt,t[n]);this._bind(n,i),this.data.contents.push(i)}this.prepareEvent("itemsChanged").enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()}},getData:function(){return this.data.contents},getAt:function(t){return t<0||t>=this.data.contents.length?null:e.ensureTypeOf(this.itemt,this.data.contents[t])},removeAt:function(t){if(t<0||t>=this.data.contents.length)return null;var n=e.ensureTypeOf(this.itemt,this.data.contents.splice(t,1)[0]);return this._unbind(n),this.prepareEvent("itemRemoved",{index:t,item:n}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),n},setAt:function(t,n){return!(t<0||t>=this.data.contents.length)&&(n=e.ensureTypeOf(this.itemt,n),this.data.contents[t]=n,this._bind(t,n),this.prepareEvent("itemChanged",{index:t,item:n}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),!0)},updateAt:function(e){return!(e<0||e>=this.data.contents.length)&&(this.prepareEvent("itemChanged",{index:e,item:this.data.contents[e]}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),!0)},push:function(t){return t&&"object"!=e.typeOf(t)?null:(t=e.ensureTypeOf(this.itemt,t),this.data.contents.push(t),this._bind(this.data.contents.length-1,t),this.prepareEvent("itemAdded",{index:this.data.contents.length-1,item:t}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),t)},pop:function(){return this._unbind(e.ensureTypeOf(this.itemt,this.data.contents.pop()))},unshift:function(t){return t&&"object"!=e.typeOf(t)?null:(t=e.ensureTypeOf(this.itemt,t),this.data.contents.unshift(t),this._bind(0,t),this.prepareEvent("itemAdded",{index:0,item:t}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume(),t)},shift:function(){return this._unbind(e.ensureTypeOf(this.itemt,this.data.contents.shift()))},find:function(t,n){for(var i=this.data.contents,s=0;s<i.length;s++)if(e.partialCompare(i[s].data,t))return n?i[s]:s;return n?null:-1}});
},{"./alpha":"axtM","./model":"rbeK"}],"xgn1":[function(require,module,exports) {
let t=require("./alpha"),n=module.exports={Type:function(n){let e={flatten:function(t,n){return t},unflatten:function(t,n){return t}};return n?t.override(e,n):e},String:function(){return n.Type({flatten:function(t,n){return null!=t?t.toString():null},unflatten:function(t,n){return null!=t?t.toString():null}})},Integer:function(){return n.Type({flatten:function(t,n){return~~t},unflatten:function(t,n){return~~t}})},Number:function(t){return n.Type({_precision:t,_round:!1,precision:function(t){return this._precision=~~t,this},flatten:function(t,n){return t=parseFloat(t),this._precision>0&&(t=~~(t*Math.pow(10,this._precision))/Math.pow(10,this._precision)),t},unflatten:function(t,n){return parseFloat(t)}})},Bool:function(t){return n.Type({_compact:t,compact:function(t){return this._compact=t,this},flatten:function(t,n){return t=~~t,this._compact?t>0?1:0:t>0},unflatten:function(t,n){return!!~~t}})},SharedString:function(){return n.Type({flatten:function(t,n){return null==t?0:(t=t.toString(),"strings"in n||(n.strings_map={},n.strings=[]),t in n.strings_map||(n.strings.push(t),n.strings_map[t]=n.strings.length),n.strings_map[t])},unflatten:function(t,n){return null==t||0==t?null:n.strings[~~t-1]}})},Array:function(t){return n.Type({itemType:t,_debug:!1,debug:function(t){return this._debug=t,this},of:function(t){return this.itemType=t,this},flatten:function(t,n){if(null==t)return null;let e=[];for(let r=0;r<t.length;r++)e.push(this.itemType.flatten(t[r],n));return e},unflatten:async function(t,n){if(null==t)return null;let e=[];for(let r=0;r<t.length;r++)e.push(await this.itemType.unflatten(t[r],n));return e}})},Object:function(){return n.Type({properties:[],property:function(t,n,e=null){return this.properties.push({name:t,type:n,defvalue:e}),this},flatten:function(t,n){if(null==t)return null;let e;if(!0===n.symbolic){e={};for(let r=0;r<this.properties.length;r++)e[this.properties[r].name]=this.properties[r].type.flatten(t[this.properties[r].name],n)}else{e=[];for(let r=0;r<this.properties.length;r++)e.push(this.properties[r].type.flatten(t[this.properties[r].name],n))}return e},unflatten:async function(t,n){if(null==t)return null;let e={};if(!0===n.symbolic)for(let r=0;r<this.properties.length;r++)e[this.properties[r].name]=await this.properties[r].type.unflatten(this.properties[r].name in t?t[this.properties[r].name]:this.properties[r].defvalue,n);else for(let r=0;r<this.properties.length;r++)e[this.properties[r].name]=await this.properties[r].type.unflatten(r in t?t[r]:this.properties[r].defvalue,n);return e}})},Class:function(t){return n.Type({_constructor:t,constructor:function(t){return this._constructor=t,this},flatten:function(t,n){return null==t?null:t.flatten(n)},unflatten:async function(t,n){return null==t?null:await(new this._constructor).unflatten(t,n)}})},Property:function(t,e){return n.Type({property:t,type:e,name:function(t){return this.property=t,this},is:function(t){return this.type=t,this},flatten:function(t,n){if(null==t)return null;let e;return!0===n.symbolic?(e={})[this.property]=this.type.flatten(t[this.property],n):e=this.type.flatten(t[this.property],n),e},unflatten:async function(t,n){if(null==t)return null;let e={};return!0===n.symbolic?e[this.property]=await this.type.unflatten(t[this.property],n):e[this.property]=await this.type.unflatten(t,n),e}})},Map:function(){return n.Type({flatten:function(t,n){if(null==t)return null;if(!0===n.symbolic)return t;let e=[];for(let r in t)e.push(r),e.push(t[r]);return e},unflatten:function(t,n){if(null==t)return null;if(!0===n.symbolic)return t;let e={};for(let r=0;r<t.length;r+=2)e[t[r]]=t[r+1];return e}})}};
},{"./alpha":"axtM"}],"RExd":[function(require,module,exports) {
let t=require("./class");module.exports=t.extend({className:"Flattenable",typeSchema:null,flatten:function(t){return this.typeSchema.flatten(this,t)},unflatten:async function(t,e){return Object.assign(this,await this.typeSchema.unflatten(t,e)),await this.onUnflattened(),this},onUnflattened:async function(){}});
},{"./class":"xPXT"}],"tkuZ":[function(require,module,exports) {
let t=require("./flattenable"),i=require("./schema"),e=require("./alpha");module.exports=t.extend({className:"Collection",itemTypeSchema:null,items:null,__ctor:function(t){t||(t=this.itemTypeSchema),t&&(this.typeSchema=i.Property("items").is(i.Array().of(t))),this.reset()},onUnflattened:function(){let t=this.items;this.reset();for(let i of t)this.add(i)},reset:function(){return this.items=[],this},clear:function(){var t=this.items;this.reset();for(var i=0;i<t.length;i++)this.onItemRemoved(t[i],0);return this},sort:function(t,i){return"function"!=typeof t?this.items.sort(function(e,s){return(e[t]<=s[t]?-1:1)*(!0===i?-1:1)}):this.items.sort(t),this},findItem:function(t,i){if(!this.items)return null;for(var s=0;s<this.items.length;s++)if((!i||!e.partialCompare(this.items[s],i))&&e.partialCompare(this.items[s],t))return this.items[s];return null},getItems:function(){return this.items},count:function(){return this.items.length},isEmpty:function(){return!this.items.length},indexOf:function(t){return this.items.indexOf(t)},getAt:function(t,i=!1){return t<0&&1==i&&(t+=this.items.length),t>=0&&t<this.items.length?this.items[t]:null},first:function(){return this.getAt(0)},last:function(){return this.getAt(-1,!0)},addAt:function(t,i){if(!i||!this.onBeforeItemAdded(i))return this;if(t<0&&(t=0),t>this.items.length&&(t=this.items.length),0==t)this.items.unshift(i);else if(t==this.items.length)this.items.push(i);else{var e=this.items.splice(0,t);e.push(i),this.items=e.concat(this.items)}return this.onItemAdded(i),this},unshift:function(t){return this.addAt(0,t)},push:function(t){return this.addAt(this.items.length,t)},add:function(t){return this.push(t)},removeAt:function(t,i=!1){if(t<0&&1==i&&(t+=this.items.length),t<0||t>=this.items.length)return null;var e=this.items[t];return this.items.splice(t,1),this.onItemRemoved(e,t),e},pop:function(t){return this.removeAt(-1,!0)},shift:function(t){return this.removeAt(0)},remove:function(t){return this.removeAt(this.indexOf(t))},forEach:function(t){if(this.isEmpty())return this;for(var i=0;i<this.items.length&&!1!==t(this.items[i],i,this);i++);return this},forEachCall:function(t,...i){if(this.isEmpty())return this;for(var e=0;e<this.items.length&&!1!==this.items[e][t](...i);e++);return this},forEachRev:function(t){if(this.isEmpty())return this;for(var i=this.items.length-1;i>=0&&!1!==t(this.items[i],i,this);i--);return this},forEachRevCall:function(t,...i){if(this.isEmpty())return this;for(var e=this.items.length-1;e>=0&&!1!==this.items[e][t](...i);e--);return this},onBeforeItemAdded:function(t){return!0},onItemAdded:function(t){},onItemRemoved:function(t){}});
},{"./flattenable":"RExd","./schema":"xgn1","./alpha":"axtM"}],"p9x3":[function(require,module,exports) {
let e=require("./alpha"),t=module.exports={strict:!1,parseTemplate:function(r,n,a,l=!1,i=1){let u="string",o=null,f=0,s=0,c="",p=[],g=p,h=!1;function d(r,l){if("template"==r?l=t.parseTemplate(l,n,a,!0,0):"parse"==r?(l=t.parseTemplate(l,n,a,!1,0),r="base-string","array"==e.typeOf(l)&&(r=l[0].type,l=l[0].data)):"parse-trim-merge"==r?l=t.parseTemplate(l.trim().split("\n").map(e=>e.trim()).join("\n"),n,a,!1,0):"parse-merge"==r?l=t.parseTemplate(l,n,a,!1,0):"parse-merge-alt"==r&&(l=t.parseTemplate(l,"{","}",!1,0)),"parse-merge"==r||"parse-merge-alt"==r||"parse-trim-merge"==r)for(let e=0;e<l.length;e++)p.push(l[e]);else p.push({type:r,data:l});h&&(g.push(p=[]),h=!1)}!0===l&&(r=r.trim(),u="identifier",f=10,g.push(p=[])),r+="\0";for(let e=0;e<r.length;e++)if("\\"!=r[e]){switch(f){case 0:"\0"==r[e]?o="string":r[e]==n&&"<"==r[e+1]?(f=1,s=1,o="string",u="parse-merge"):r[e]==n&&"@"==r[e+1]?(f=1,s=1,o="string",u="parse-trim-merge",e++):r[e]==n&&":"==r[e+1]?(f=12,s=1,o="string",u="string",e++):r[e]==n?(f=1,s=1,o="string",u="template"):c+=r[e];break;case 1:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s){f=0,o=u;break}}else r[e]==n&&s++;c+=r[e];break;case 10:if("\0"==r[e]){o=u;break}if("."==r[e]){d(u,c),d("access","."),u="identifier",c="";break}if(null!=r[e].match(/[\t\n\r\f\v ]/)){for(o=u,u="identifier",h=!0;null!=r[e].match(/[\t\n\r\f\v ]/);)e++;e--;break}if(r[e]==n&&"<"==r[e+1]){c&&(o=u),f=11,s=1,u="parse-merge";break}if(r[e]==n&&"@"==r[e+1]){c&&(o=u),f=11,s=1,u="parse-trim-merge",e++;break}if('"'==r[e]){c&&(o=u),f=14,s=1,u="parse-merge";break}if("'"==r[e]){c&&(o=u),f=15,s=1,u="parse-merge";break}if("`"==r[e]){c&&(o=u),f=16,s=1,u="parse-merge-alt";break}if(r[e]==n&&":"==r[e+1]){c&&(o=u),f=13,s=1,u="string",e++;break}if(r[e]==n){c&&d(u,c),f=11,s=1,c="",u="parse",c+=r[e];break}"identifier"!=u&&(d(u,c),c="",u="identifier"),c+=r[e];break;case 11:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}else r[e]==n&&s++;c+=r[e];break;case 12:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s){0!=c.length&&"<"!=c[0]&&"["!=c[0]&&" "!=c[0]&&(c=n+c+a),f=0,o=u;break}}else r[e]==n&&s++;c+=r[e];break;case 13:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if(r[e]==a){if(--s<0)throw new Error("Parse error: Unmatched "+a);if(0==s){"<"!=c[0]&&"["!=c[0]&&" "!=c[0]&&(c=n+c+a),f=10;break}}else r[e]==n&&s++;c+=r[e];break;case 14:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if('"'==r[e]){if(--s<0)throw new Error('Parse error: Unmatched "');if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}c+=r[e];break;case 15:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if("'"==r[e]){if(--s<0)throw new Error("Parse error: Unmatched '");if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}c+=r[e];break;case 16:if("\0"==r[e])throw new Error("Parse error: Unexpected end of template");if("`"==r[e]){if(--s<0)throw new Error("Parse error: Unmatched `");if(0==s&&(f=10,"parse-merge"==u||"parse-merge-alt"==u||"parse-trim-merge"==u))break}c+=r[e]}o&&(d(o,c),o=c="")}else c+="\\",c+=r[++e];if(!l){let e=0;for(;e<g.length&&"string"==g[e].type&&""==g[e].data;)g.splice(e,1);for(e=g.length-1;e>0&&"string"==g[e].type&&""==g[e].data;)g.splice(e--,1);0==g.length&&g.push({type:"string",data:""})}return i&&function e(t){if("object"==typeof t){if(t instanceof Array)for(let r=0;r<t.length;r++)e(t[r]);else t.data=e(t.data);return t}for(let r=0;r<t.length;r++)if("\\"==t[r]){let e=t[r+1];switch(e){case"n":e="\n";break;case"r":e="\r";break;case"f":e="\f";break;case"v":e="\v";break;case"t":e="\t";break;case"s":e="s";break;case'"':e='"';break;case"'":e="'"}t=t.substr(0,r)+e+t.substr(r+2)}return t}(g),g},parse:function(e){return this.parseTemplate(e.trim(),"[","]",!1)},expand:function(r,n,a="text",l="base-string"){let i=[];if("var"==l){let e=!0,a=!1,l=n,u=null,o=!0,f="";for(let i=0;i<r.length&&null!=n;i++)switch(r[i].type){case"identifier":case"string":f+=r[i].data,u=null;break;case"template":f+="object"!=typeof(u=this.expand(r[i].data,l,"arg","template"))?u:"";break;case"base-string":f+=this.expand(r[i].data,l,"arg","base-string"),u=null;break;case"access":if(u&&"object"==typeof u)n=u;else{for(f||(f="this");;)if("!"==f[0])f=f.substr(1),e=!1;else{if("$"!=f[0])break;f=f.substr(1),a=!0}if("this"!=f&&null!=n){let e=n;null===(n=f in n?n[f]:null)&&o&&f in t.functions&&(n=t.functions[f](null,null,e)),o=!1}}f=""}for(;""!=f;)if("!"==f[0])f=f.substr(1),e=!1;else{if("$"!=f[0])break;f=f.substr(1),a=!0}if("this"!=f){let e=!1;if(null!=n?f in n?n=n[f]:(e=!0,n=null):e=!0,e&&1==r.length&&1==t.strict)throw new Error("Expression function `"+f+"` not found.")}"string"==typeof n&&(e&&(n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a&&(n='"'+n+'"')),i.push(n)}if("varref"==a){let e=n,a=null,l=!0,i="";for(let u=0;u<r.length&&null!=n;u++)switch(r[u].type){case"identifier":case"string":i+=r[u].data,a=null;break;case"template":i+="object"!=typeof(a=this.expand(r[u].data,e,"arg","template"))?a:"";break;case"base-string":i+=this.expand(r[u].data,e,"arg","base-string"),a=null;break;case"access":if(a&&"object"==typeof a)n=a;else{for(i||(i="this");;)if("!"==i[0])i=i.substr(1);else{if("$"!=i[0])break;i=i.substr(1)}if("this"!=i&&null!=n){let e=n;null===(n=i in n?n[i]:null)&&l&&i in t.functions&&(n=t.functions[i](null,null,e)),l=!1}}i=""}for(;""!=i;)if("!"==i[0])i=i.substr(1);else{if("$"!=i[0])break;i=i.substr(1)}return"this"!=i?[n,i]:null}if("fn"==l){var u=[];if(u.push(t.expand(r[0],n,"text","base-string")),"_"+u[0]in t.functions&&(u[0]="_"+u[0]),!(u[0]in t.functions)){if(1==t.strict)throw new Error("Expression function `"+u[0]+"` not found.");return`(Unknown: ${u[0]})`}if("_"==u[0][0])return t.functions[u[0]](r,n);for(let e=1;e<r.length;e++)u.push(t.expand(r[e],n,"arg","base-string"));i.push(t.functions[u[0]](u,r,n))}if("template"==l){if(1==r.length){if(1==r[0].length&&"string"==r[0][0].type)return r[0][0].data;if(1==r[0].length&&"identifier"==r[0][0].type){let e=r[0][0].data;if(e in t.functions||"_"+e in t.functions)return t.expand(r,n,a,"fn")}return t.expand(r[0],n,a,"var")}return t.expand(r,n,a,"fn")}if("base-string"==l){let e=-1;for(let l of r){let u=null;switch(e++,l.type){case"template":u=t.expand(l.data,n,a,"template");break;case"string":case"identifier":u=l.data;break;case"base-string":u=t.expand(l.data,n,a,"base-string")}"void"!=a&&("last"==a&&e!=r.length-1||i.push(u))}}if("obj"==a)return i;if("last"==a)return"Rose\\Arry"==typeOf(i)&&(i=i[0]),i;if("void"==a)return null;if("arg"==a)return"array"==e.typeOf(i)?1!=i.length?i.join(""):i[0]:i;if("text"==a&&"array"==e.typeOf(i)){let e=t=>null!=t&&"object"==typeof t?"map"in t?t.map(e).join(""):"join"in t?t.join(""):t.toString():t;i=i.map(e).join("")}return i},compile:function(e){return e=t.parse(e),function(r=null,n="text"){return t.expand(e,r||{},n)}},eval:function(e,r=null,n="text"){return e=t.parse(e),t.expand(e,r||{},n)},value:function(r,n=null){return"array"!=e.typeOf(r)?r:t.expand(r,n||{},"arg")},register:function(e,r){t.functions[e]=r},call:function(e,r,n=null){return e in t.functions?t.functions[e](r,null,n):null},getNamedValues:function(e,r,n=1,a=!0){let l={},i=0;for(;n<e.length;n+=2){let u=t.expand(e[n],r,"arg");i||(i=u.startsWith(":")?1:u.endsWith(":")?2:3),1==i?u=u.substr(1):2==i&&(u=u.substr(0,u.length-1)),l[u]=a?t.expand(e[n+1],r,"arg"):e[n+1]}return l}};t.functions={null:function(e){return null},true:function(e){return!0},false:function(e){return!1},len:function(e){return e[1].toString().length},int:function(e){return~~e[1]},str:function(e){return e[1].toString()},float:function(e){return parseFloat(e[1])},chr:function(e){return String.fromCharCode(e[1])},ord:function(e){return e[1].toString().charCodeAt(0)},not:function(e){return!e[1]},neg:function(e){return-e[1]},abs:function(e){return Math.abs(e[1])},and:function(e){for(let t=1;t<e.length;t++)if(!e[t])return!1;return!0},or:function(e){for(let t=1;t<e.length;t++)if(~~e[t])return!0;return!1},eq:function(e){return e[1]==e[2]},ne:function(e){return e[1]!=e[2]},lt:function(e){return e[1]<e[2]},le:function(e){return e[1]<=e[2]},gt:function(e){return e[1]>e[2]},ge:function(e){return e[1]>=e[2]},isnotnull:function(e){return!!e[1]},isnull:function(e){return!e[1]},iszero:function(e){return 0==parseInt(e[1])},"eq?":function(e){return e[1]==e[2]},"ne?":function(e){return e[1]!=e[2]},"lt?":function(e){return e[1]<e[2]},"le?":function(e){return e[1]<=e[2]},"gt?":function(e){return e[1]>e[2]},"ge?":function(e){return e[1]>=e[2]},"notnull?":function(e){return!!e[1]},"null?":function(e){return!e[1]},"zero?":function(e){return 0==parseInt(e[1])},typeof:function(t){return e.typeOf(t[1])},"*":function(e){let t=e[1];for(let r=2;r<e.length;r++)t*=e[r];return t},mul:function(e){let t=e[1];for(let r=2;r<e.length;r++)t*=e[r];return t},"/":function(e){let t=e[1];for(let r=2;r<e.length;r++)t/=e[r];return t},div:function(e){let t=e[1];for(let r=2;r<e.length;r++)t/=e[r];return t},"+":function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=-e[r];return t},sum:function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=-e[r];return t},"-":function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=e[r];return t},sub:function(e){let t=e[1];for(let r=2;r<e.length;r++)t-=e[r];return t},mod:function(e){let t=e[1];for(let r=2;r<e.length;r++)t%=e[r];return t},"**":function(e){let t=e[1];for(let r=2;r<e.length;r++)t=Math.pow(t,e[r]);return t},pow:function(e){let t=e[1];for(let r=2;r<e.length;r++)t=Math.pow(t,e[r]);return t},json:function(e){return JSON.stringify(e[1])},_set:function(e,r){for(let n=1;n+1<e.length;n+=2){let a=t.value(e[n+1],r);if(e[n].length>1){let l=t.expand(e[n],r,"varref");null!=l&&(l[0][l[1]]=a)}else r[t.value(e[n],r)]=a}return""},_unset:function(e,r){for(let n=1;n<e.length;n++)if(e[n].length>1){let a=t.expand(e[n],r,"varref");null!=a&&delete a[0][a[1]]}else delete r[t.value(e[n],r)];return null},trim:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.trim()):e[1].trim():""},upper:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.toUpperCase()):e[1].toUpperCase():""},lower:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.toLowerCase()):e[1].toLowerCase():""},substr:function(e){let t=e[e.length-1].toString(),r=0,n=null;return 4==e.length?(r=~~e[1],n=~~e[2]):(r=~~e[1],n=null),r<0&&(r+=t.length),n<0&&(n+=t.length),null===n&&(n=t.length-r),t.substr(r,n)},replace:function(e){return e[3].split(e[1]).join(e[2])},nl2br:function(e){return e[1]?"object"==typeof e[1]?e[1].map(e=>e.replace(/\n/g,"<br/>")):e[1].replace(/\n/g,"<br/>"):""},"%":function(t){t.shift();var r=t.shift();let n="";for(let a=0;a<t.length;a++)if("array"==e.typeOf(t[a])){n+=`<${r}>`;for(let e=0;e<t[a].length;e++)n+=t[a][e];n+=`</${r}>`}else n+=`<${r}>${t[a]}</${r}>`;return n},"%%":function(e){e.shift();var t=e.shift();let r="",n="";for(let a=0;a<e.length;a+=2)a+1<e.length?r+=` ${e[a]}="${e[a+1]}"`:n=e[a];return n?`<${t}${r}>${n}</${t}>`:`<${t}${r}/>`},join:function(t){return t[2]&&"array"==e.typeOf(t[2])?t[2].join(t[1]):""},split:function(e){return e[2]&&"string"==typeof e[2]?e[2].split(e[1]):[]},keys:function(e){return e[1]&&"object"==typeof e[1]?Object.keys(e[1]):[]},values:function(e){return e[1]&&"object"==typeof e[1]?Object.values(e[1]):[]},_each:function(e,r){let n=t.expand(e[1],r,"arg"),a=t.expand(e[2],r,"arg"),l=[],i=0;if(!a)return l;for(let u in a)r[n]=a[u],r[n+"##"]=i++,r[n+"#"]=u,l.push(t.expand(e[3],r,"text"));return delete r[n],delete r[n+"##"],delete r[n+"#"],l},_foreach:function(e,r){let n=t.expand(e[1],r,"arg"),a=t.expand(e[2],r,"arg"),l=0;if(!a)return null;for(let i in a)r[n]=a[i],r[n+"##"]=l++,r[n+"#"]=i,t.expand(e[3],r,"text");return delete r[n],delete r[n+"##"],delete r[n+"#"],null},"_?":function(e,r){return t.expand(e[1],r,"arg")?t.expand(e[2],r,"arg"):e.length>3?t.expand(e[3],r,"arg"):""},"_??":function(e,r){let n=t.expand(e[1],r,"arg");return n||t.expand(e[2],r,"arg")},_if:function(e,r){for(let n=0;n<e.length;n+=3){if("else"==t.expand(e[n],r,"arg"))return t.expand(e[n+1],r,"text");if(t.expand(e[n+1],r,"arg"))return t.expand(e[n+2],r,"text")}return""},_switch:function(e,r){let n=t.expand(e[1],r,"arg");for(let a=2;a<e.length;a+=2){let l=t.expand(e[a],r,"arg");if(l==n||"default"==l)return t.expand(e[a+1],r,"text")}return""},_break:function(e,t){throw new Error("EXC_BREAK")},_continue:function(e,t){throw new Error("EXC_CONTINUE")},_repeat:function(e,r){if(e.length<3||1!=(1&e.length))return"(`repeat`: Wrong number of parameters)";let n=t.value(e[1],r),a=null,l=0,i=null,u=null;for(let c=2;c<e.length-1;c+=2){switch(t.value(e[c],r).toLowerCase()){case"from":l=parseFloat(t.value(e[c+1],r));break;case"to":i=parseFloat(t.value(e[c+1],r));break;case"count":a=parseFloat(t.value(e[c+1],r));break;case"step":u=parseFloat(t.value(e[c+1],r))}}let o=e[e.length-1],f=[];if(null!==i)if(null===u&&(u=l>i?-1:1),u<0)for(let c=l;c>=i;c+=u)try{r[n]=c,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}else for(let c=l;c<=i;c+=u)try{r[n]=c,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}else if(null!==a){null===u&&(u=1);for(let e=l;a>0;a--,e+=u)try{r[n]=e,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}}else{null===u&&(u=1);for(let e=l;;e+=u)try{r[n]=e,f.push(t.value(o,r))}catch(s){let e=s.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw s}}return delete r[n],f},_for:function(e,r){if(e.length<3||1!=(1&e.length))return"(`for`: Wrong number of parameters)";let n=t.value(e[1],r),a=null,l=0;to=null;let i=null;for(let f=2;f<e.length-1;f+=2)switch(value=t.value(e[f],r),value.toLowerCase()){case"from":l=parseFloat(t.value(e[f+1],r));break;case"to":to=parseFloat(t.value(e[f+1],r));break;case"count":a=parseFloat(t.value(e[f+1],r));break;case"step":i=parseFloat(t.value(e[f+1],r))}let u=e[e.length-1];if(null!==to)if(null===i&&(i=l>to?-1:1),i<0)for(let f=l;f>=to;f+=i)try{r[n]=f,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}else for(let f=l;f<=to;f+=i)try{r[n]=f,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}else if(null!==a){null===i&&(i=1);for(let e=l;a>0;a--,e+=i)try{r[n]=e,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}}else{null===i&&(i=1);for(let e=l;;e+=i)try{r[n]=e,t.value(u,r)}catch(o){let e=o.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw o}}return delete r[n],null},_loop:function(e,r){if(e.length<2)return"(`loop`: Wrong number of parameters)";let n=e[1];for(;;)try{t.value(n,r)}catch(a){let e=a.message;if("EXC_BREAK"==e)break;if("EXC_CONTINUE"==e)continue;throw a}return null},_echo:function(e,r){let n="";for(let a=1;a<e.length;a++)n+=t.expand(e[a],r,"arg");return console.log(n),""},"_#":function(e,r){let n=[];for(let a=1;a<e.length;a++)n.push(t.expand(e[a],r,"arg"));return n},"_##":function(e,t){let r=[];for(let n=1;n<e.length;n++)r.push(e[n]);return r},"_&":function(e,r){return t.getNamedValues(e,r,1,!0)},"_&&":function(e,r){return t.getNamedValues(e,r,1,!1)},contains:function(e,t,r){let n=e[1];if("object"!=typeof n)return r.err="Argument is not a Map",!1;let a="";for(let l=2;l<e.length;l++)e[l]in n||(a+=", "+e[l]);return""==a||(r.err=a.substr(1),!1)},has:function(t,r,n){let a=t[2];return"object"==e.typeOf(a)&&t[1]in a},_map:function(r,n){let a=t.expand(r[1],n,"arg"),l=t.expand(r[2],n,"arg");if(!l)return l;let i="array"==e.typeOf(l),u=i?[]:{},o=0;for(let e in l)n[a]=l[e],n[a+"##"]=o++,n[a+"#"]=e,i?u.push(t.expand(r[3],n,"arg")):u[e]=t.expand(r[3],n,"arg");return delete n[a],delete n[a+"##"],delete n[a+"#"],u},_filter:function(r,n){let a=t.expand(r[1],n,"arg"),l=t.expand(r[2],n,"arg");if(!l)return l;let i="array"==e.typeOf(l),u=i?[]:{},o=0;for(let e in l)n[a]=l[e],n[a+"##"]=o++,n[a+"#"]=e,~~t.expand(r[3],n,"arg")&&(i?u.push(l[e]):u[e]=l[e]);return delete n[a],delete n[a+"##"],delete n[a+"#"],u},expand:function(e,r,n){return t.expand(t.parseTemplate(e[1],"{","}"),3==e.length?e[2]:n)},_call:function(e,r){let n=t.expand(e[1],r,"varref");if(!n||"function"!=typeof n[0][n[1]])throw new Error("Expression is not a function: "+t.expand(e[1],r,"obj").map(e=>null==e?".":e).join(""));let a=[];for(let l=2;l<e.length;l++)a.push(t.value(e[l],r));return n[0][n[1]](...a)}};
},{"./alpha":"axtM"}],"OHwo":[function(require,module,exports) {
let e=require("./alpha");e.Rin=e,e.Class=require("./class"),e.Event=require("./event"),e.EventDispatcher=require("./event-dispatcher"),e.Model=require("./model"),e.ModelList=require("./model-list"),e.Schema=require("./schema"),e.Flattenable=require("./flattenable"),e.Collection=require("./collection"),e.Template=require("./template"),Object.assign(module.exports,e);
},{"./alpha":"axtM","./class":"xPXT","./event":"K4NB","./event-dispatcher":"aK92","./model":"rbeK","./model-list":"J25A","./schema":"xgn1","./flattenable":"RExd","./collection":"tkuZ","./template":"p9x3"}],"aqx4":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin"),i=module.exports=t.extend({className:"TFunction",t:null,y:null,f:null,__ctor:function(t){this.reset(t)},reset:function(t=0){return this.t=[0],this.y=[t],this.f=[null],this},copyFrom:function(t,i,n){if(this.t=[],this.y=[],this.f=[],null==i&&null==n){for(let i=0;i<t.t.length;i++)this.t.push(t.t[i]),this.y.push(t.y[i]),this.f.push(t.f[i]);return this}null==i&&(i=t.t[0]),null==n&&(n=t.t[t.t.length-1]),i<t.t[0]&&(i=t.t[0]);let h=t.find(i),s=t.find(n);if(null==h)return null;if(null==s)return null;t.t[h]!=i&&(this.set(i,t.getAt(i),t.f[h]),h++);for(let l=h;l<=s;l++)this.set(t.t[l],t.y[l],t.f[l]);if(t.t[s]!=n){let i=(n-t.t[s])/Math.ceil(Math.log(n-t.t[s])),h=this.t[this.t.length-1];for(i<=0&&(i=1),i=n-h;h!=n;)h+i>n&&(i=n-h),h+=i,this.set(float4(h),t.getAt(h),t.f[s])}return this},clone:function(t,n){return(new i).copyFrom(this,t,n)},endTime:function(t=0){return this.t[this.t.length-1]+t},startTime:function(t=0){return this.t[0]+t},find:function(t){if(t<this.t[0])return null;const i=this.t.length;for(let n=1;n<i;n++)if(t<this.t[n])return n-1;return i-1},set:function(t,i,n=null){let h=this.find(t);return null!=h&&(this.t[h]==t?(this.y[h]=i,null!=n&&(this.f[h]=n)):(h++,this.t.splice(h,0,t),this.y.splice(h,0,i),this.f.splice(h,0,n)),!0)},get:function(){return this.y[this.y.length-1]},getAt:function(t){let i=this.find(t);if(null==i)return 0;let n=i+1;if(this.t[i]==t||n>=this.t.length||this.y[i]==this.y[n]||null==this.f[i])return this.y[i];if(null==this.f[i])return this.y[i];let h=t,s=this.t[i],l=this.t[n],e=this.y[i],r=this.y[n];return t=(h-s)/(l-s),(t=this.f[i](t))*r+(1-t)*e},integral:function(t=null,i=null,n=0){null==t&&(t=this.t[0]),null==i&&(i=this.t[this.t.length-1]),t<this.t[0]&&(t=this.t[0]);let h=1;if(t>i){let n;n=t,t=i,i=n,h=-1}let s=n;for(let l=t;l<i;){let t=this.find(l);if(null==t)return 0;let n=t+1,h=Math.max(this.t[t],l),e=Math.min(n<this.t.length?this.t[n]:i,i),r=this.getAt(h),u=e-h,f=this.getAt(e)-r;null==this.f[t]?s+=r*u:s+=.5*f*(e+h)-h*f+r*u,l+=u}return h*s},second_integral:function(t=null,n=null,h=0){null==t&&(t=this.t[0]),null==n&&(n=this.t[this.t.length-1]);let s=i.Temp1.copyFrom(this,this.t[0],t).integrate(h).integral();return i.Temp2.copyFrom(this,this.t[0],n).integrate(h).integral()-s},integrate:function(t=0){let i=[];i.push(t);for(let n=1;n<this.t.length;n++)i.push(i[n-1]+this.integral(this.t[n-1],this.t[n]));return this.y=i,this},accumulate:function(t=0){this.y[0]+=t;for(let i=1;i<this.t.length;i++)this.y[i]+=this.y[i-1];return this},chopLeft:function(t){return this.t.splice(0,t),this.f.splice(0,t),this.y.splice(0,t),this},chopRight:function(t){return this.t.splice(t+1,this.t.length-t-1),this.f.splice(t+1,this.f.length-t-1),this.y.splice(t+1,this.y.length-t-1),this},map:function(t){for(let i=0;i<this.y.length;i++)this.y[i]=t(this.y[i],this.t[i],i);return this},toString:function(t=0){let i="",n=10;const h=function(t,i,n){for(t=t.toString(),null==n&&(n=" "),n=n[0];t.length<i;)t+=n;return t};i+="\n",i+=h(" Time",n)+" "+h(" Value",n)+" "+h(" Integral",n)+"\n",i+=h("",n,"-")+" "+h("",n,"-")+" "+h("",n,"-")+"\n";for(let s=0;s<this.t.length;s++)i+=h(" "+float4(this.t[s]),n)+" "+h(" "+float4(this.y[s]),n)+" "+h(" "+float4(this.integral(this.t[0],this.t[s],t)),n)+"\n";return i}});i.Temp1=new i,i.Temp2=new i;
},{"@rsthn/rin":"OHwo"}],"no3j":[function(require,module,exports) {
let t=module.exports=function(t,i){this.data=[],this.accumSize=t,this.expectedValue=i,this.stdSum=0,this.stdCount=0};t.prototype.begin=function(){this.startTime=performance.now()},t.prototype.end=function(){this.feed(performance.now()-this.startTime)},t.prototype.feed=function(t){this.data.push(t),this.data.length==this.accumSize&&(this.report(),this.data=[])},t.prototype.report=function(t){for(var i=null,e=null,s=0,a=0,h=0;h<this.data.length;h++)i=null===i?this.data[h]:Math.min(i,this.data[h]),e=null===e?this.data[h]:Math.max(e,this.data[h]),s+=this.data[h];s/=this.data.length;var d=void 0!==this.expectedValue?this.expectedValue:s;for(h=0;h<this.data.length;h++)a+=Math.pow(this.data[h]-d,2);a=Math.sqrt(a/this.data.length),this.stdSum+=a,this.stdCount++;var o="N: "+this.stdCount+", MIN: "+i+", MAX: "+e+", AVG: "+s.toFixed(2)+(void 0!==this.expectedValue?", E: "+this.expectedValue:"")+", STDDEV: "+a.toFixed(2)+", AVG_STDDEV: "+(this.stdSum/this.stdCount).toFixed(2);if(this.min=i,this.max=e,this.avg=s,this.std=a,!0===t)return o;console.log(o)};
},{}],"a5Xg":[function(require,module,exports) {
module.exports={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,SPACE:32,PGUP:33,PGDN:34,END:35,HOME:36,INS:45,DEL:46,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUM_PLUS:107,NUM_MINUS:109,NUM_ASTERISK:106,NUM_SLASH:111,NUM_DOT:110,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};
},{}],"E606":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin"),e=require("./recycler"),n=module.exports=t.extend({className:"Linkable",prev:null,next:null,value:null,__ctor:function(t){this.value=t,this.clear()},__reinit:function(t){return this.value=t,this.clear(),this},__dtor:function(){},clear:function(){return this.next=this.prev=null,this},linkAfter:function(t){this.prev=t,this.next=t?t.next:null,t&&(t.next&&(t.next.prev=this),t.next=this)},linkBefore:function(t){this.prev=t?t.prev:null,this.next=t,t&&(t.prev&&(t.prev.next=this),t.prev=this)},unlink:function(){return this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.clear()}});e.attachTo(n);
},{"@rsthn/rin":"OHwo","./recycler":"nZpH"}],"LwHP":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin"),n=require("./linkable"),o=module.exports=t.extend({className:"List",top:null,bottom:null,count:0,__ctor:function(){this.top=null,this.bottom=null,this.count=0},__dtor:function(){this.reset()},clear:function(){var t,n;for(t=this.top;null!=t;t=n)n=t.next,dispose(t.value),dispose(t);return this.top=this.bottom=null,this.count=0,this},reset:function(){var t,n;for(t=this.top;null!=t;t=n)n=t.next,dispose(t);return this.top=this.bottom=null,this.count=0,this},getAt:function(t){var n=null;for(n=this.top;n&&t--;n=n.next);return null!=n?n.value:null},getNodeAt:function(t){var n=null;for(n=this.top;n&&t--;n=n.next);return n},sgetNode:function(t){for(var n=this.top;n;n=n.next)if(n.value==t)return n;return null},remove:function(t){if(null==t||"isInstanceOf"in t&&t.isInstanceOf(n)||(t=this.sgetNode(t)),!t)return null;t.prev||(this.top=t.next),t.next||(this.bottom=t.prev),this.count--;var o=t.unlink().value;return dispose(t),o},insertBefore:function(t,o){if(!t)return this;var i=n.alloc(o);return i.linkBefore(t),t==this.top&&(this.top=i),this.count++,this},insertAfter:function(t,o){if(!t)return this;var i=n.alloc(o);return i.linkAfter(t),t==this.bottom&&(this.bottom=i),this.count++,this},unshift:function(t){var o=n.alloc(t);return o.linkBefore(this.top),this.bottom||(this.bottom=o),this.top=o,this.count++,this},shift:function(){var t=this.top;if(!t)return null;(this.top=t.next)||(this.bottom=null),this.count--;var n=t.unlink().value;return dispose(t),n},push:function(t){var o=n.alloc(t);return o.linkAfter(this.bottom),this.top||(this.top=o),this.bottom=o,this.count++,this},pop:function(){var t=this.bottom;if(!t)return null;(this.bottom=t.prev)||(this.top=null),this.count--;var n=t.unlink().value;return dispose(t),n},append:function(t){for(var n=t.top;n;n=n.next)this.push(n.value);return this}});
},{"@rsthn/rin":"OHwo","./linkable":"E606"}],"mNIK":[function(require,module,exports) {
require("./globals");const t=module.exports=function(t,i,s=!1){this.callback=i,this.interval=t,this.highPerformance=s};t.prototype.onTimeout=function(){if(this.isRunning)if(this.highPerformance){for(var t=this.lastTime+this.interval;hrnow()<t;);var i=hrnow(),s=i-this.lastTime;this.lastTime=i,this.callback(s,this),this.runAfter(0)}else{this.rTime=hrnow()-this.startTime;var h=this.rTime-(this.sTime+this.interval);if(h<0)return void this.runAfter(-h);this.sTime+=this.interval*(1+int(h/this.interval)),this.tDelta=h<0?this.interval:this.rTime-this.lTime,this.lTime=this.rTime,this.callback(this.tDelta,this),this.runAfter(this.sTime+this.interval-(hrnow()-this.startTime))}},t.prototype.onStart=function(){},t.prototype.start=function(t=!1,i=1){this.startTime=hrnow(),this.sTime=0,this.lTime=0,this.lastTime=hrnow(),this.isRunning=!0,this.onStart(),t&&this.callback(0,this),this.runAfter(this.interval*i)},t.prototype.runAfter=function(t){setTimeout(()=>this.onTimeout(),t)},t.prototype.stop=function(){this.isRunning=!1};
},{"./globals":"JxzF"}],"iBRc":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];const{Rin:e}=require("@rsthn/rin"),i=require("./matrix"),r=module.exports=function(n,o){null==n?(this.elem=t.document?t.document.createElement("canvas"):e.clone(r.passThruCanvas),t.document&&o&&1!=o.hidden&&(t.document.body.appendChild(this.elem),!0===o.absolute&&(this.elem.style.position="absolute",this.elem.style.left="0px",this.elem.style.top="0px"))):this.elem=n,this.elem.getContext&&(!0===o.gl?(this.gl=this.elem.getContext("webgl")||this.elem.getContext("experimental-webgl"),this.context=null,this.initGl()):(this.context=this.elem.getContext("2d"),this.gl=null),this.antialias=!o||!1!==o.antialias,this.setBackground(o&&null!=o.background?o.background:"#000"),this.matrixStack=[],this.alphaStack=[],this.matr=new i,this._alpha=1,this._globalScale=1,this.matr.identity(),null!=this.context&&(this.transform(),this.strokeStyle("#fff"),this.fillStyle("#fff")),this.resize())};r.passThruCanvas={parentNode:null,imageSmoothingEnabled:!0,style:{},width:950,height:540,getContext:function(t){return this},save:function(){},restore:function(){},scale:function(t,e){},rotate:function(t){},translate:function(t,e){},setTransform:function(t,e,i,r,n,o){},transform:function(t,e,i,r,n,o){},toDataURL:function(t,e){return""},beginPath:function(){},moveTo:function(t,e){},closePath:function(){},lineTo:function(){},rect:function(t,e,i,r){},fill:function(){},stroke:function(){},fillRect:function(t,e,i,r){},strokeRect:function(t,e,i,r){},clip:function(){},quadraticCurveTo:function(t,e,i,r){},bezierCurveTo:function(t,e,i,r,n,o){},arc:function(t,e,i,r,n,o){},arcTo:function(t,e,i,r,n){},fillText:function(t,e,i,r){},strokeText:function(t,e,i,r){},measureText:function(t){return{width:0}},createImageData:function(t,e){return{width:t,height:e}},getImageData:function(t,e,i,r){return{width:i,height:r,data:[]}},putImageData:function(t,e,i){},drawImage:function(...t){},getBoundingClientRect:function(){return{left:0,top:0}}},r.prototype.buildShader=function(t,e,i){const r=this.gl,n=r.createShader(e);if(r.shaderSource(n,i),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error("compilerShader: "+r.getShaderInfoLog(n));r.attachShader(t,n)},r.prototype.initGl=function(){let t=this.gl;if(this.gl_array_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.gl_array_buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.gl_program=t.createProgram(),this.buildShader(this.gl_program,t.VERTEX_SHADER,"\n\t\t#version 100\n\t\tattribute vec2 location;\n\t\tuniform vec2 screen_size;\n\t\tuniform vec2 texture_size;\n\t\tuniform mat3 location_matrix;\n\t\tuniform mat3 texture_matrix;\n\t\tuniform mat3 current_matrix;\n\t\tuniform sampler2D texture;\n\t\tvarying highp vec2 f_texcoords;\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(((vec2(current_matrix*location_matrix*vec3(location, 1.0))/screen_size)*2.0-vec2(1.0, 1.0))*vec2(1.0, -1.0), 0.0, 1.0);\n\t\t\tf_texcoords = vec2(texture_matrix*vec3(location, 1.0))/texture_size;\n\t\t}\n\t"),this.buildShader(this.gl_program,t.FRAGMENT_SHADER,"\n\t\tuniform sampler2D texture;\n\t\tvarying highp vec2 f_texcoords;\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = texture2D(texture, f_texcoords);\n\t\t}\n\t"),t.linkProgram(this.gl_program),!t.getProgramParameter(this.gl_program,t.LINK_STATUS))throw new Error("linkProgram: "+t.getProgramInfoLog(program));t.useProgram(this.gl_program),t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.clearDepth(0),t.depthFunc(t.GEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.gl_attrib_location=t.getAttribLocation(this.gl_program,"location"),this.gl_uniform_screen_size=t.getUniformLocation(this.gl_program,"screen_size"),this.gl_uniform_texture_size=t.getUniformLocation(this.gl_program,"texture_size"),this.gl_uniform_texture=t.getUniformLocation(this.gl_program,"texture"),this.gl_uniform_matrix=t.getUniformLocation(this.gl_program,"location_matrix"),this.gl_uniform_current_matrix=t.getUniformLocation(this.gl_program,"current_matrix"),this.gl_uniform_texture_matrix=t.getUniformLocation(this.gl_program,"texture_matrix"),t.enableVertexAttribArray(this.gl_attrib_location),t.vertexAttribPointer(this.gl_attrib_location,2,t.FLOAT,t.FALSE,2*Float32Array.BYTES_PER_ELEMENT,0*Float32Array.BYTES_PER_ELEMENT),this.location_matrix=new i,this.texture_matrix=new i,this.current_matrix=new i,this.drawImage=function(...e){const i=e[0],r=e[1],n=e[2];if(this.gl_active_texture!=i.gl_texture&&(this.gl.activeTexture(t.TEXTURE0),this.gl.bindTexture(t.TEXTURE_2D,i.gl_texture),this.gl.uniform1i(this.gl_uniform_texture,0),this.gl.uniform2fv(this.gl_uniform_texture_size,[i.width,i.height]),this.gl_active_texture=i.gl_texture),3==e.length)return;const o=e[3],s=e[4];if(5==e.length)return;const a=e[5],h=e[6],l=e[7],u=e[8];this.current_matrix.set(this.matr),this.current_matrix.transpose(),this.location_matrix.identity(),this.location_matrix.translate(a,h),this.location_matrix.scale(l,u),this.location_matrix.transpose(),this.texture_matrix.identity(),this.texture_matrix.translate(r,n),this.texture_matrix.scale(o,s),this.texture_matrix.transpose(),this.gl.uniformMatrix3fv(this.gl_uniform_current_matrix,!1,this.current_matrix.data),this.gl.uniformMatrix3fv(this.gl_uniform_matrix,!1,this.location_matrix.data),this.gl.uniformMatrix3fv(this.gl_uniform_texture_matrix,!1,this.texture_matrix.data),this.gl.drawArrays(t.TRIANGLE_STRIP,0,4)}},r.prototype.prepareImage=function(t){let e=this.gl;if(null==e)return;let i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t.gl_texture=i,t.gl_ready=!0},r.prototype.applyConfig=function(){0==this.antialias?(null!=this.context&&(this.context.imageSmoothingEnabled=!1),this.elem.style.imageRendering="crisp-edges"):(null!=this.context&&(this.context.imageSmoothingEnabled=!0),this.elem.style.imageRendering="auto")},r.prototype.dispose=function(){this.elem.parentNode&&this.elem.parentNode.removeChild(this.elem),this.matrixStack=null,this.alphaStack=null,this.matr=null,this.context=null,this.elem=null},r.prototype.setBackground=function(t,e){this.elem.style.background=t,this.backgroundColor=e||t},r.prototype.resize=function(t,e){let i=this.elem.getBoundingClientRect();return t||(t=i.width),e||(e=i.height),this.elem.width=t,this.elem.height=e,this.width=this.elem.width,this.height=this.elem.height,this._width=~~(this.width/this._globalScale),this._height=~~(this.height/this._globalScale),null!=this.gl&&(this.gl.viewport(0,0,t,e),this.gl_uniform_screen_size&&this.gl.uniform2fv(this.gl_uniform_screen_size,[t,e])),this.applyConfig(),this},r.prototype.globalScale=function(t){return this._globalScale=t,this._width=~~(this.width/this._globalScale),this._height=~~(this.height/this._globalScale),this.loadIdentity(),this.scale(t,t),this},r.prototype.flipped=function(t){return t?(this._width=~~(this.height/this._globalScale),this._height=~~(this.width/this._globalScale)):(this._width=~~(this.width/this._globalScale),this._height=~~(this.height/this._globalScale)),this},r.prototype.save=function(){return this.context.save(),this},r.prototype.restore=function(){return this.context.restore(),this},r.prototype.toDataUrl=function(t,e){return this.elem.toDataURL(t,e)},r.prototype.toPng64=function(){return this.elem.toDataURL("image/png").substr(22)},r.prototype._contextAttribute=function(t,e){return void 0!==e?(this.context[t]=e,this):this.context[t]},r.prototype.fillStyle=function(t){return this._contextAttribute("fillStyle",t)},r.prototype.strokeStyle=function(t){return this._contextAttribute("strokeStyle",t)},r.prototype.lineCap=function(t){return this._contextAttribute("lineCap",t)},r.prototype.lineJoin=function(t){return this._contextAttribute("lineJoin",t)},r.prototype.lineWidth=function(t){return this._contextAttribute("lineWidth",t)},r.prototype.miterLimit=function(t){return this._contextAttribute("miterLimit",t)},r.prototype.shadowColor=function(t){return this._contextAttribute("shadowColor",t)},r.prototype.shadowOffsetX=function(t){return this._contextAttribute("shadowOffsetX",t)},r.prototype.shadowOffsetY=function(t){return this._contextAttribute("shadowOffsetY",t)},r.prototype.shadowBlur=function(t){return this._contextAttribute("shadowBlur",t)},r.prototype.font=function(t){return this._contextAttribute("font",t)},r.prototype.textAlign=function(t){return this._contextAttribute("textAlign",t)},r.prototype.textBaseline=function(t){return this._contextAttribute("textBaseline",t)},r.prototype.globalAlpha=function(t){return void 0===t?this._alpha:(this._alpha=t,this.alpha(1))},r.prototype.alpha=function(t){return this._alpha*=t,this.context&&(this.context.globalAlpha=this._alpha),this},r.prototype.globalCompositeOperation=function(t){return this._contextAttribute("globalCompositeOperation",t)},r.prototype.transform=function(t,e,i,r,n,o){return null==this.context?this:arguments.length?(this.context.transform(t,e,i,r,n,o),this):(this.context.setTransform(this.matr.data[0],this.matr.data[3],this.matr.data[1],this.matr.data[4],this.matr.data[2],this.matr.data[5]),this)},r.prototype.setTransform=function(t,e,i,r,n,o){return this.context.setTransform(t,e,i,r,n,o),this},r.prototype.fillRect=function(t,e,i,r){return this.context.fillRect(t,e,i,r),this},r.prototype.strokeRect=function(t,e,i,r){return this.context.strokeRect(t,e,i,r),this},r.prototype.clearRect=function(t,e,i,r){return this.context.clearRect(t,e,i,r),this},r.prototype.beginPath=function(){return this.context.beginPath(),this},r.prototype.moveTo=function(t,e){return this.context.moveTo(t,e),this},r.prototype.closePath=function(){return this.context.closePath(),this},r.prototype.lineTo=function(t,e){return this.context.lineTo(t,e),this},r.prototype.rect=function(t,e,i,r){return this.context.rect(t,e,i,r),this},r.prototype.fill=function(t){return t&&this.fillStyle(t),this.context.fill(),this},r.prototype.stroke=function(t){return t&&this.strokeStyle(t),this.context.stroke(),this},r.prototype.clip=function(){return this.context.clip(),this},r.prototype.quadraticCurveTo=function(t,e,i,r){return this.context.quadraticCurveTo(t,e,i,r),this},r.prototype.bezierCurveTo=function(t,e,i,r,n,o){return this.context.bezierCurveTo(t,e,i,r,n,o),this},r.prototype.arc=function(t,e,i,r,n,o){return this.context.arc(t,e,i,r,n,o),this},r.prototype.arcTo=function(t,e,i,r,n){return this.context.arcTo(t,e,i,r,n),this},r.prototype.fillText=function(t,e,i,r){return this.context.fillText(t,e,i,r||1e3),this},r.prototype.strokeText=function(t,e,i,r){return this.context.strokeText(t,e,i,r||1e3),this},r.prototype.measureText=function(t){return this.context.measureText(t).width},r.prototype.createImageData=function(t,e){return this.context.createImageData(t,e)},r.prototype.getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},r.prototype.putImageData=function(t,e,i){return this.context.putImageData(t,e,i),this},r.prototype.drawImage=function(...t){if(3==t.length)this.context.drawImage(t[0],~~t[1],~~t[2]);else if(5==t.length)this.context.drawImage(t[0],~~t[1],~~t[2],~~t[3],~~t[4]);else if(9==t.length){var e=~~t[3],i=~~t[4];if(!e||!i)return this;var r=~~t[7],n=~~t[8];if(!r||!n)return this;this.context.drawImage(t[0],~~t[1],~~t[2],e,i,~~t[5],~~t[6],r,n)}return this},r.prototype.clear=function(t){return null!=this.gl?(this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.gl_active_texture=null,this):(t?this.globalCompositeOperation("source-over").globalAlpha(1).fillStyle(!0!==t?t:this.backgroundColor).fillRect(0,0,this._width,this._height):(this.elem.width=this.width,this.applyConfig()),this.transform(),this)},r.prototype.reset=function(t){return this.fillStyle("#000000").strokeStyle("#000000").lineCap("butt").lineJoin("miter").lineWidth("1").miterLimit("10").shadowColor("#000000").shadowOffsetX("0").shadowOffsetY("0").shadowBlur("0").globalAlpha("1.0").globalCompositeOperation("source-over"),t&&this.beginPath().closePath(),this},r.prototype.pushMatrix=function(){return this.matrixStack.push(this.matr),this.matr=this.matr.clone(),this},r.prototype.popMatrix=function(){return this.matr=this.matrixStack.pop(),this.transform()},r.prototype.pushAlpha=function(){return this.alphaStack.push(this.globalAlpha()),this},r.prototype.popAlpha=function(){return this.globalAlpha(this.alphaStack.pop()),this},r.prototype.loadIdentity=function(){return this.matr.identity(),this.transform()},r.prototype.loadMatrix=function(t){return this.matr.identity().append(t),this.transform()},r.prototype.getMatrix=function(){return this.matr.clone()},r.prototype.appendMatrix=function(t){return this.matr.append(t),this.transform()},r.prototype.scale=function(t,e,i){return i?(this.context.scale(t,e),this):(this.matr.scale(t,e),this.transform())},r.prototype.rotate=function(t,e){return e?(this.context.rotate(t),this):(this.matr.rotate(t),this.transform())},r.prototype.translate=function(t,e,i){return i?(this.context.translate(t,e),this):(this.matr.translate(t,e),this.transform())},r.prototype.ellipse=function(t,e,i,r){var n=i/2*.5522848,o=r/2*.5522848,s=t+i-1,a=e+r-1,h=t+i/2,l=e+r/2;return this.beginPath().moveTo(t,l),this.bezierCurveTo(t,l-o,h-n,e,h,e),this.bezierCurveTo(h+n,e,s,l-o,s,l),this.bezierCurveTo(s,l+o,h+n,a,h,a),this.bezierCurveTo(h-n,a,t,l+o,t,l),this.closePath(),this},r.prototype.circle=function(t,e,i,r){return this.beginPath(),this.arc(t,e,i,0,2*Math.PI),this.closePath(),r&&this.stroke(r),this},r.prototype.line=function(t,e,i,r,n){return this.beginPath(),this.moveTo(t,e),this.lineTo(i,r),this.closePath(),n&&this.stroke(n),this},r.prototype.enablePointerEvents=function(){if(this.pointerHandler)return this;this.pointerScale={sx:1,sy:1},this.pointerOffset={x:0,y:0};var t=this,e={action:"",buttons:0,lbuttons:0,x:0,y:0,containedBy:function(t,e,i,r){return this.x>=t&&this.x<=t+i-1&&this.y>=e&&this.y<=e+r-1}};return this.pointerHandlers=[],this.pointerHandler=function(i,r){var n=this.elem.getBoundingClientRect();e.action=i,e.buttons=r.buttons,e.x=e.rx=~~(r.clientX-n.left),e.y=e.ry=~~(r.clientY-n.top),e.x=(e.x-t.pointerOffset.x-0*t.pointerScale.sx)/t.pointerScale.sx,e.y=(e.y-t.pointerOffset.y-0*t.pointerScale.sy)/t.pointerScale.sy,e.dragging=!1,e.buttons&&!e.lbuttons&&(e.sx=e.x,e.sy=e.y,e.ldx=e.ldy=0),e.buttons&&e.lbuttons&&(e.dragging=!0,e.dx=e.x-e.sx,e.dy=e.y-e.sy,e.ddx=e.dx-e.ldx,e.ddy=e.dy-e.ldy,e.ldx=e.dx,e.ldy=e.dy),e.lbuttons=e.buttons;for(var o=0;o<this.pointerHandlers.length&&!1!==this.pointerHandlers[o][1].call(this.pointerHandlers[o][2],e);o++);},this.elem.onmousedown=function(e){t.pointerHandler("DOWN",e)},this.elem.onmouseup=function(e){t.pointerHandler("UP",e)},this.elem.onmousemove=function(e){t.pointerHandler("MOVE",e)},this},r.prototype.setPointerScale=function(t,e){return this.pointerScale={sx:t,sy:e},this},r.prototype.setPointerOffset=function(t,e){return this.pointerOffset={x:t,y:e},this},r.prototype.addPointerHandler=function(t,e){return this.enablePointerEvents(),this.pointerHandlers.push([this.pointerHandlers.length+"_"+~~(1e6*Math.random()),t,e]),this.pointerHandlers[this.pointerHandlers.length-1][0]},r.prototype.removePointerHandler=function(t){if(this.pointerHandlers)for(var e=0;e<this.pointerHandlers.length;e++)if(this.pointerHandlers[e][0]==t){this.pointerHandlers.splice(e,1);break}},r.prototype.drawImageResource=function(t,e,i,r,n){return null==r?this.drawImage(t.data,0,0,t.data.width,t.data.height,e,i,t.width,t.height):this.drawImage(t.data,0,0,t.data.width,t.data.height,e,i,r,n)};
},{"@rsthn/rin":"OHwo","./matrix":"vOmO"}],"mu8O":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];require("./globals");const t=require("./keycodes"),i=require("./list"),s=require("./linkable"),a=require("./timer"),r=require("./canvas"),n=module.exports={flags:{renderingEnabled:!1,renderingPaused:!1},EVT_KEY_DOWN:1,EVT_KEY_UP:2,EVT_POINTER_DOWN:16,EVT_POINTER_UP:17,EVT_POINTER_MOVE:18,EVT_POINTER_DRAG_START:19,EVT_POINTER_DRAG_MOVE:20,EVT_POINTER_DRAG_STOP:21,DEFAULT:0,LANDSCAPE:1,PORTRAIT:2,AUTOMATIC:3,defaultOptions:{background:"#000",gl:!1,canvas:null,canvas2:null,fps:60,minFps:15,context:null,antialias:!0,targetScreenWidth:null,targetScreenHeight:null,orientation:0,extraScaleFactor:1,fullscreen:!0},screenWidth:0,screenHeight:0,offsX:0,offsY:0,devicePixelRatio:1,backingStoreRatio:1,canvasPixelRatio:1,canvasScaleFactor:1,scaleFactor:1,initialMatrix:null,displayBuffer:null,displayBuffer2:null,tempDisplayBuffer:null,keyState:{time:0,shift:!1,ctrl:!1,alt:!1,keyCode:0},pointerState:{},updateQueue:null,drawQueue:null,timeScale:1,frameInterval:0,fixedFrameInterval:0,maxFrameInterval:0,frameDelta:0,frameDeltaMillis:0,frameTime:0,frameTimeMillis:0,frameNumber:0,frameUpdateInProgress:!1,frameDrawInProgress:!1,perf:{startTime:0,lastTime:0,numFrames:0,updateTime:0,drawTime:0},init:function(s){var o={};Object.assign(o,this.defaultOptions),s&&Object.assign(o,s),this.options=o,o.targetScreenWidth&&o.targetScreenHeight&&o.orientation==n.DEFAULT&&(o.orientation=o.targetScreenWidth>o.targetScreenHeight?n.LANDSCAPE:n.PORTRAIT),this.orientation=o.orientation,this.updateQueue=new i,this.drawQueue=new i,this.frameInterval=int(1e3/o.fps),this.maxFrameInterval=int(1e3/o.minFps),e.onresize=this.onWindowResized.bind(this),this.frameTimer=new a(this.frameInterval,this.onFrame.bind(this),!0),this.displayBuffer=new r(null,{gl:o.gl,elem:o.canvas,absolute:!0,hidden:!1,antialias:o.antialias,background:o.background}),this.displayBuffer2=new r(null,{gl:!1,elem:o.canvas2,absolute:!0,hidden:!1,antialias:o.antialias,background:"none"}),this.displayBuffer2.elem.style.pointerEvents="none",this.tempDisplayBuffer=new r(null,{hidden:!0,antialias:o.antialias}).resize(320,240);var c=this.displayBuffer.elem;this.devicePixelRatio=e.devicePixelRatio||1,this.backingStoreRatio=1==o.gl?1:this.displayBuffer.context.webkitBackingStorePixelRatio||this.displayBuffer.context.mozBackingStorePixelRatio||this.displayBuffer.context.msBackingStorePixelRatio||this.displayBuffer.context.oBackingStorePixelRatio||this.displayBuffer.context.backingStorePixelRatio||1,this.canvasPixelRatio=this.devicePixelRatio/this.backingStoreRatio,n.onWindowResized(!0);var h=this;e.onkeydown=function(i){if(i.target===e.document.body){if(h.keyState[i.keyCode])return!1;switch(h.keyState[i.keyCode]=!0,h.keyState.keyCode=i.keyCode,h.keyState.startTime=n.now(!0),i.keyCode){case 16:h.keyState.shift=!0;break;case 17:h.keyState.ctrl=!0;break;case 18:h.keyState.alt=!0}return h.keyState.ctrl&&i.keyCode==t.TAB?(h.keyState[i.keyCode]=!1,!0):!1!==h.onKeyboardEvent(h.EVT_KEY_DOWN,i.keyCode,h.keyState)&&void 0}},e.onkeyup=function(t){if(t.target===e.document.body){if(!h.keyState[t.keyCode])return!1;switch(h.keyState[t.keyCode]=!1,h.keyState.endTime=n.now(!0),h.keyState.keyCode=t.keyCode,t.keyCode){case 16:h.keyState.shift=!1;break;case 17:h.keyState.ctrl=!1;break;case 18:h.keyState.alt=!1}return!1!==h.onKeyboardEvent(h.EVT_KEY_UP,t.keyCode,h.keyState)&&void 0}},"ontouchstart"in e?(c.ontouchstart=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++){n.pointerState[t[i].identifier]||(n.pointerState[t[i].identifier]={id:t[i].identifier,isActive:!1,isDragging:!1,sx:0,sy:0,x:0,y:0,dx:0,dy:0,button:0});var s=n.pointerState[t[i].identifier];s.isActive=!0,s.isDragging=!1,s.button=1,s.startTime=n.now(!0),s.x=s.sx=n.reverseRender?~~((t[i].clientY-n.offsY)/n.canvasScaleFactor):~~((t[i].clientX-n.offsX)/n.canvasScaleFactor),s.y=s.sy=n.reverseRender?~~(n.screenHeight-(t[i].clientX-n.offsX)/n.canvasScaleFactor-1):~~((t[i].clientY-n.offsY)/n.canvasScaleFactor),n.onPointerEvent(n.EVT_POINTER_DOWN,s,n.pointerState)}return!1},c.ontouchend=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++)if(n.pointerState[t[i].identifier]){var s=n.pointerState[t[i].identifier];s.endTime=n.now(!0),s.deltaTime=s.endTime-s.startTime,s.x=n.reverseRender?~~((t[i].clientY-n.offsY)/n.canvasScaleFactor):~~((t[i].clientX-n.offsX)/n.canvasScaleFactor),s.y=n.reverseRender?~~(n.screenHeight-(t[i].clientX-n.offsX)/n.canvasScaleFactor-1):~~((t[i].clientY-n.offsY)/n.canvasScaleFactor),s.isDragging&&n.onPointerEvent(n.EVT_POINTER_DRAG_STOP,s,n.pointerState),n.onPointerEvent(n.EVT_POINTER_UP,s,n.pointerState),s.isActive=!1,s.isDragging=!1,s.button=0}return!1},c.ontouchcancel=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++)if(n.pointerState[t[i].identifier]){var s=n.pointerState[t[i].identifier];s.x=n.reverseRender?~~((t[i].clientY-n.offsY)/n.canvasScaleFactor):~~((t[i].clientX-n.offsX)/n.canvasScaleFactor),s.y=n.reverseRender?~~(n.screenHeight-(t[i].clientX-n.offsX)/n.canvasScaleFactor-1):~~((t[i].clientY-n.offsY)/n.canvasScaleFactor),n.onPointerEvent(s.isDragging?n.EVT_POINTER_DRAG_STOP:n.EVT_POINTER_UP,s,n.pointerState),s.isActive=!1,s.isDragging=!1,s.button=0}return!1},c.ontouchmove=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++)if(n.pointerState[t[i].identifier]){var s=n.pointerState[t[i].identifier];s.isActive&&!s.isDragging&&(n.onPointerEvent(n.EVT_POINTER_DRAG_START,s,n.pointerState),s.isDragging=!0),s.x=n.reverseRender?~~((t[i].clientY-n.offsY)/n.canvasScaleFactor):~~((t[i].clientX-n.offsX)/n.canvasScaleFactor),s.y=n.reverseRender?~~(n.screenHeight-(t[i].clientX-n.offsX)/n.canvasScaleFactor-1):~~((t[i].clientY-n.offsY)/n.canvasScaleFactor),s.dx=s.x-s.sx,s.dy=s.y-s.sy,n.onPointerEvent(s.isDragging?n.EVT_POINTER_DRAG_MOVE:n.EVT_POINTER_MOVE,s,n.pointerState)}return!1}):(c.onmousedown=function(e){e.preventDefault(),n.pointerState[0]||(n.pointerState[0]={id:0,isActive:!1,isDragging:!1,button:0,sx:0,sy:0,x:0,y:0,dx:0,dy:0});var t=n.pointerState[0];return t.isActive=!0,t.isDragging=!1,t.button=e.which,t.x=t.sx=n.reverseRender?~~((e.clientY-n.offsY)/n.canvasScaleFactor):~~((e.clientX-n.offsX)/n.canvasScaleFactor),t.y=t.sy=n.reverseRender?~~(n.screenHeight-(e.clientX-n.offsX)/n.canvasScaleFactor-1):~~((e.clientY-n.offsY)/n.canvasScaleFactor),n.onPointerEvent(n.EVT_POINTER_DOWN,t,n.pointerState),!1},c.onmouseup=function(e){if(e.preventDefault(),!n.pointerState[0])return!1;var t=n.pointerState[0];t.x=n.reverseRender?~~((e.clientY-n.offsY)/n.canvasScaleFactor):~~((e.clientX-n.offsX)/n.canvasScaleFactor),t.y=n.reverseRender?~~(n.screenHeight-(e.clientX-n.offsX)/n.canvasScaleFactor-1):~~((e.clientY-n.offsY)/n.canvasScaleFactor),t.isDragging&&n.onPointerEvent(n.EVT_POINTER_DRAG_STOP,t,n.pointerState),n.onPointerEvent(n.EVT_POINTER_UP,t,n.pointerState),t.isActive=!1,t.isDragging=!1,t.button=0},c.onmousemove=function(e){if(e.preventDefault(),!n.pointerState[0])return!1;var t=n.pointerState[0];return t.isActive&&!t.isDragging&&(n.onPointerEvent(n.EVT_POINTER_DRAG_START,t,n.pointerState),t.isDragging=!0),t.x=n.reverseRender?~~((e.clientY-n.offsY)/n.canvasScaleFactor):~~((e.clientX-n.offsX)/n.canvasScaleFactor),t.y=n.reverseRender?~~(n.screenHeight-(e.clientX-n.offsX)/n.canvasScaleFactor-1):~~((e.clientY-n.offsY)/n.canvasScaleFactor),t.dx=t.x-t.sx,t.dy=t.y-t.sy,n.onPointerEvent(t.isDragging?n.EVT_POINTER_DRAG_MOVE:n.EVT_POINTER_MOVE,t,n.pointerState),!1})},now:function(e){var t=hrnow();return e?t/1e3:t},time:function(){return this.frameTime},start:function(){this.onWindowResized(),this.flags.renderingPaused=!1,this.frameTimer.start()},stop:function(){this.flags.renderingPaused=!0,this.frameTimer.stop()},pause:function(){this.flags.renderingPaused=!0},resume:function(){this.flags.renderingPaused=!1,this.resetPerf()},onFrame:function(e,t){var i,s=this.now();if(e>this.maxFrameInterval&&(e=this.maxFrameInterval),0!=this.fixedFrameInterval&&(e=this.fixedFrameInterval),this.flags.renderingEnabled&&!this.flags.renderingPaused){0==this.perf.numFrames&&(this.perf.startTime=s-this.frameInterval,this.perf.lastTime=s),e*=this.timeScale,this.frameDeltaMillis=e,this.frameDelta=e/1e3,this.frameTimeMillis+=this.frameDeltaMillis,this.frameTime+=this.frameDelta,this.frameNumber++,this.frameUpdateInProgress=!0,i=hrnow();try{this.update(this.frameDelta,this.frameDeltaMillis)}catch(a){console.error("UPDATE ERROR: "+a+"\n"+a.stack),n.stop()}this.perf.updateTime+=hrnow()-i,this.frameUpdateInProgress=!1,this.frameDrawInProgress=!0,i=hrnow();try{this.draw(this.displayBuffer,this.displayBuffer2)}catch(a){console.error("DRAW ERROR: \n"+a+"\n"+a.stack),n.stop()}this.perf.drawTime+=hrnow()-i,this.frameDrawInProgress=!1,this.perf.lastTime=s,this.perf.numFrames++}else{this.frameDrawInProgress=!0;try{this.draw(this.displayBuffer,this.displayBuffer2)}catch(a){console.error("DRAW ERROR: \n"+a+"\n"+a.stack)}this.frameDrawInProgress=!1}},onWindowResized:function(t){"document"in e?this.options.fullscreen?(this._screenWidth=int(e.screen.width),this._screenHeight=int(e.screen.height)):(this._screenWidth=e.innerWidth,this._screenHeight=e.innerHeight):(this._screenWidth=this.options.targetScreenWidth,this._screenHeight=this.options.targetScreenHeight),this.canvasScaleFactor=1,this._screenWidth<this._screenHeight&&this.orientation==n.LANDSCAPE||this._screenWidth>this._screenHeight&&this.orientation==n.PORTRAIT?(this.screenWidth=this._screenHeight,this.screenHeight=this._screenWidth,this.reverseRender=!0):(this.screenWidth=this._screenWidth,this.screenHeight=this._screenHeight,this.reverseRender=!1);let i=this.options.targetScreenWidth,s=this.options.targetScreenHeight;this.orientation==n.AUTOMATIC&&i&&s&&(i>s&&this.screenWidth<this.screenHeight||i<s&&this.screenWidth>this.screenHeight)&&(i=s,s=this.options.targetScreenWidth),i&&s?this.canvasScaleFactor=Math.min(this.screenWidth/i,this.screenHeight/s):i?this.canvasScaleFactor=this.screenWidth/i:s&&(this.canvasScaleFactor=this.screenHeight/s);var a=this.screenWidth,r=this.screenHeight;if(i&&(this.screenWidth=i),s&&(this.screenHeight=s),this.offsX=int(.5*(a-this.screenWidth*this.canvasScaleFactor)),this.offsY=int(.5*(r-this.screenHeight*this.canvasScaleFactor)),this.reverseRender){var o=this.offsX;this.offsX=this.offsY,this.offsY=o}this.scaleFactor=this.canvasScaleFactor*this.canvasPixelRatio,this.scaleFactor=~~(.7+this.scaleFactor),this.flags.renderingEnabled=!1,"document"in e&&(e.document.body.style.backgroundColor=this.displayBuffer.backgroundColor),this.reverseRender?(this.displayBuffer.resize(this.screenHeight*this.scaleFactor,this.screenWidth*this.scaleFactor),this.displayBuffer.elem.style.width=this.screenHeight*this.canvasScaleFactor+"px",this.displayBuffer.elem.style.height=this.screenWidth*this.canvasScaleFactor+"px",this.displayBuffer2.resize(this.screenHeight*this.scaleFactor,this.screenWidth*this.scaleFactor),this.displayBuffer2.elem.style.width=this.screenHeight*this.canvasScaleFactor+"px",this.displayBuffer2.elem.style.height=this.screenWidth*this.canvasScaleFactor+"px"):(this.displayBuffer.resize(this.screenWidth*this.scaleFactor,this.screenHeight*this.scaleFactor),this.displayBuffer.elem.style.width=this.screenWidth*this.canvasScaleFactor+"px",this.displayBuffer.elem.style.height=this.screenHeight*this.canvasScaleFactor+"px",this.displayBuffer2.resize(this.screenWidth*this.scaleFactor,this.screenHeight*this.scaleFactor),this.displayBuffer2.elem.style.width=this.screenWidth*this.canvasScaleFactor+"px",this.displayBuffer2.elem.style.height=this.screenHeight*this.canvasScaleFactor+"px"),this.displayBuffer.elem.style.marginLeft=this.offsX+"px",this.displayBuffer.elem.style.marginTop=this.offsY+"px",this.displayBuffer2.elem.style.marginLeft=this.offsX+"px",this.displayBuffer2.elem.style.marginTop=this.offsY+"px",this.displayBuffer.loadIdentity(),this.displayBuffer2.loadIdentity(),1!=this.scaleFactor&&(this.displayBuffer.globalScale(this.scaleFactor),this.displayBuffer2.globalScale(this.scaleFactor)),this.reverseRender&&(this.displayBuffer.rotate(-Math.PI/2),this.displayBuffer.translate(0,-this.screenHeight),this.displayBuffer.flipped(!0),this.displayBuffer2.rotate(-Math.PI/2),this.displayBuffer2.translate(0,-this.screenHeight),this.displayBuffer2.flipped(!0)),this.scaleFactor*=this.options.extraScaleFactor,this.integerScaleFactor=~~(this.scaleFactor+.9),this.resetPerf(),this.initialMatrix=this.displayBuffer.getMatrix(),1!=t&&(this.flags.renderingEnabled=!0,this.onCanvasResized(this.screenWidth,this.screenHeight))},onCanvasResized:function(e,t){},resetPerf:function(){this.perf.numFrames=0},updateQueueAdd:function(e){return this.updateQueue.push(e),this.updateQueue.bottom},updateQueueRemove:function(e){this.updateQueue.remove(e instanceof s?e:this.updateQueue.sgetNode(e))},drawQueueAdd:function(e){return this.drawQueue.push(e),this.drawQueue.bottom},drawQueueRemove:function(e){this.drawQueue.remove(e instanceof s?e:this.drawQueue.sgetNode(e))},queueAdd:function(e){return this.updateQueue.push(e),this.drawQueue.push(e),e},queueRemove:function(e){this.updateQueue.remove(this.updateQueue.sgetNode(e)),this.drawQueue.remove(this.drawQueue.sgetNode(e))},update:function(e,t){for(var i,s=this.updateQueue.top;s;s=i)i=s.next,s.value.update(e,t)},draw:function(e,t){for(var i,s=this.drawQueue.top;s;s=i)i=s.next,s.value.draw(e,t)},interpolate:function(e,t,i,s,a){let r={},o={},c=0;for(let n in e)r[n]=0,o[n]=e[n],c++;let h={update:function(l){for(let a in r){if(r[a]==i[a])continue;r[a]+=l,r[a]>=i[a]&&(r[a]=i[a],c--);let n=s[a](r[a]/i[a]);o[a]=(1-n)*e[a]+n*t[a]}a(o,0==c),0==c&&n.updateQueueRemove(h)}};n.updateQueueAdd(h),h.update(0)},onKeyboardEvent:function(e,t,i){},onPointerEvent:function(e,t,i){}};
},{"./globals":"JxzF","./keycodes":"a5Xg","./list":"LwHP","./linkable":"E606","./timer":"mNIK","./canvas":"iBRc"}],"eRAA":[function(require,module,exports) {
const e=require("./system"),t=module.exports={enabled:!1,data:[],count:0,maxsize:30,debugEcho:!1,color:"#fff",background:"#000",write:function(e){if(this.enabled){for(this.data.push(e),this.count++;this.data.length>this.maxsize;)this.data.shift();this.debugEcho&&console.debug(this.count+": "+e)}},clear:function(){this.data=[],this.count=0},enable:function(a,i,o,l,n){this.enabled||(this.enabled=!0,a||(a=0),i||(i=0),o||(o=8.5),!1===l&&(i-=16),e.drawQueueAdd({draw:function(r,d){d.clear(),d.font("normal "+o+"pt 'Bitstream Vera Sans Mono', monospace"),d.textBaseline("top");var s=(e.perf.lastTime-e.perf.startTime)/1e3,u=e.perf.numFrames,c="";!1!==l&&(c="FPS: "+(u/s).toFixed(2)+", update: "+(e.perf.updateTime/u).toFixed(2)+", draw: "+(e.perf.drawTime/u).toFixed(2),t.background&&(d.fillStyle(t.background),d.fillRect(a+8-3,i+10-1,d.measureText(c)+6,o+4)),d.fillStyle(t.color),d.fillText(c,a+8,i+10));for(var f=0;f<t.data.length;f++)c=(!1!==n?"#"+(t.count-t.data.length+f+1)+": ":"> ")+t.data[f],t.background&&(d.fillStyle(t.background),d.fillRect(a+8-3,i+16+(o+4)*(f+1)-1,d.measureText(c)+6,o+4)),d.fillStyle(t.color),d.fillText(c,a+8,i+16+(o+4)*(f+1))}}))}};
},{"./system":"mu8O"}],"Uwqb":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin");module.exports=t.extend({className:"Drawable",width:null,height:null,__ctor:function(t){if("image"!=t.type)throw new Error("Resource is not an image.");this.r=t,this.r.wrapper=this,this.width=this.r.width,this.height=this.r.height},draw:function(t,r,e,i,h){null==i?t.drawImageResource(this.r,r,e):t.drawImageResource(this.r,r,e,i,h)},getDrawable:function(){return this}});
},{"@rsthn/rin":"OHwo"}],"EU1j":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin");module.exports=t.extend({className:"DrawableRect",width:null,height:null,__ctor:function(t){if("object"!=t.type)throw new Error("Resource is not an object.");this.r=t,this.r.wrapper=this,this.width=this.r.width,this.height=this.r.height},draw:function(t,i,e){t.fillStyle(this.r.color),t.fillRect(i,e,this.width,this.height)},getDrawable:function(){return this}});
},{"@rsthn/rin":"OHwo"}],"vcfM":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin"),i=require("../canvas");module.exports=t.extend({className:"SpriteSheet",width:0,height:0,numCols:0,numFrames:0,drawableCache:null,__ctor:function(t){if("image"!=t.type&&"images"!=t.type)throw new Error("Resource is not a sprite sheet.");var i,e;if("image"==t.type){if(!(t.config.sheetWidth||t.config.numFrames&&t.config.frameWidth))throw new Error("Required sheetWidth or numFrames+frameWidth");t.config.sheetWidth||(t.config.sheetWidth=t.config.numFrames*t.config.frameWidth),t.config.frameHeight||(t.config.frameHeight=t.data.height),i=t.data.width/t.config.sheetWidth,e=t.width/t.config.sheetWidth}else t.config||(t.config={}),t.config.frameWidth||(t.config.frameWidth=t.data[0].width),t.config.frameHeight||(t.config.frameHeight=t.data[0].height),i=t.data[0].data.width/t.config.frameWidth,e=t.data[0].width/t.config.frameWidth;var h=t.config.frameWidth,a=t.config.frameHeight;this.r_frameWidth=h*i,this.r_frameHeight=a*i,this.width=h*e,this.height=a*e,"image"==t.type?(this.numCols=~~(t.data.width/this.r_frameWidth),this.numRows=Math.ceil(t.data.height/this.r_frameHeight),this.numFrames=t.config.numFrames||this.numCols*this.numRows):(this.numCols=this.numRows=0,this.numFrames=t.data.length),this.drawableCache={},this.r=t,this.r.wrapper=this},drawFrame:function(t,i,e,h,a,r){if(!(h<0||h>=this.numFrames))if(a||(a=this.width),r||(r=this.height),0!=this.numCols){var s=~~(h/this.numCols)*this.r_frameHeight,n=h%this.numCols*this.r_frameWidth;t.drawImage(this.r.data,n,s,this.r_frameWidth,this.r_frameHeight,i,e,a,r)}else t.drawImage(this.r.data[h].data,0,0,this.r_frameWidth,this.r_frameHeight,i,e,a,r)},getDrawable:function(t){return 2==arguments.length&&(t=arguments[1]*this.numCols+arguments[0]),this.drawableCache[t]||(this.drawableCache[t]={width:this.width,height:this.height,frameIndex:t,r:this,draw:function(t,i,e,h,a){t.drawFrame(this.r,i,e,this.frameIndex,h,a)}}),this.drawableCache[t]}}),i.prototype.drawFrame=function(t,i,e,h,a,r){t.drawFrame(this,i,e,h,a,r)};
},{"@rsthn/rin":"OHwo","../canvas":"iBRc"}],"tfUv":[function(require,module,exports) {
const{Class:s}=require("@rsthn/rin"),i=require("./spritesheet"),t=require("../system"),e=s.extend({seq:null,seq_i:0,trans:null,trans_i:0,trans_t:null,queue:null,fps:0,frameMillis:0,time:0,frameNumber:-1,finished:!1,paused:!1,width:null,height:null,onFinishedCallback:null,onFinishedArg:null,onFrameCallback:null,onFrameArg:null,__ctor:function(s,i,t){this.anim=s,this.queue=[],this.seq=i,this.trans=null,this.width=s.width,this.height=s.height,this.fps=t,this.setFps(this.seq.fps||this.fps)},__dtor:function(){},setFps:function(s){return this.frameMillis=~~(1e3/s),this.time=0,this},setPaused:function(s){return this.paused=s,this},setInitialDelay:function(s){return this.time=1e3*-s,this},onFinished:function(s,i){return this.onFinishedCallback=s,this.onFinishedArg=i,this},onFrame:function(s,i){return this.onFrameCallback=s,this.onFrameArg=i,this},setFrame:function(s){return this.seq_i=s%this.seq.group.length,this},getFrame:function(s){return!0===s?this.seq_i/(this.seq.group.length-1):this.seq_i},getLength:function(){return this.seq.group.length},draw:function(s,i,e){if(this.time<0)return this.paused||(this.time+=this.frameNumber==t.frameNumber?0:t.frameDeltaMillis,this.frameNumber=t.frameNumber),void(this.time>0&&(this.time=0));if(this.seq_i!=this.seq.group.length){n=this.seq.group[this.seq_i];if(null!=s)for(r=0;r<n.length;r++)s.drawFrame(this.anim,i,e,n[r]);if(this.paused||(this.time+=this.frameNumber==t.frameNumber?0:t.frameDeltaMillis,this.frameNumber=t.frameNumber),this.time>=this.frameMillis){const s=this.seq_i;this.time-=this.frameMillis,this.seq_i++,this.seq_i==this.seq.group.length&&(null!=this.trans?(++this.trans_i==this.trans.length?(this.trans=null,this.seq=this.trans_t):this.seq=this.trans[this.trans_i],this.seq_i=0,this.time=0,this.finished=!1):(this.seq.loop?this.seq_i=0:(this.finished=!0,this.onFinishedCallback&&(this.onFinishedCallback(this.onFinishedArg),this.onFinishedCallback=null)),this.queue.length&&this.use(this.queue.shift(),!0))),this.onFrameCallback&&!1===this.onFrameCallback(s,this.seq.group.length-1,this.onFrameArg)&&(this.onFrameCallback=null)}}else{var n=this.seq.group[this.seq_i-1];if(null!=s)for(var r=0;r<n.length;r++)s.drawFrame(this.anim,i,e,n[r])}},advance:function(){this.setPaused(!1),this.draw(null,0,0)},use:function(s,i){var t=null==this.trans?this.seq:this.trans_t;return t.name==s&&!0!==i?this:(t.trans&&t.trans[s]?(this.trans_t=this.anim.a.seq[s],this.trans=t.trans[s],this.trans_i=0,this.seq=this.trans[this.trans_i]):(this.seq=this.anim.a.seq[s],this.setFps(this.seq.fps||this.fps)),this.seq_i=0,this.time=0,this.finished=!1,this)},setQueue:function(s){this.queue=s,this.use(this.queue.shift(),!0)},enqueue:function(s,i){var t=null==this.trans?this.seq:this.trans_t;return t.name==s&&t.loop?this:!0!==i&&this.queue.length>0&&this.queue[this.queue.length-1]==s?this:t.loop||this.finished?(this.use(s,!0),this):(this.queue.push(s),this)}}),n=module.exports=i.extend({className:"SpriteSheetAnimation",__ctor:function(s){if(!s.anim)throw new Error("Animation descriptors not found.");this._super.SpriteSheet.__ctor(s),this.r=s,this.r.wrapper=this;var i=this.a=this.r.anim;if(!i.initialized){if(i.def||(i.def="def"),i.seq||(i.seq={}),!i.seq[i.def]&&("def"==i.def||"defloop"==i.def)){for(var t={loop:"def"!=i.def,group:[]},e=0;e<this.numFrames;e++)t.group.push([e]);i.seq[i.def]=t}if(!i.seq[i.def])throw new Error("Undefined default sequence: "+i.def);i.fps||(i.fps=25),i.def=i.seq[i.def];var n=0;for(var e in i.seq){var r,h,a;if(i.seq[e].name=e,i.seq[e].loop||(i.seq[e].loop=!1),"string"==typeof i.seq[e].group)if(-1!=i.seq[e].group.indexOf(" "))for(var u in r=i.seq[e].group.split(" "),i.seq[e].group=[],r)i.seq[e].group.push([int(r[u])]);else if(-1!=i.seq[e].group.indexOf(","))for(a=i.seq[e].group.split(","),r=int(a[0]),h=int(a[1]),i.seq[e].group=[],a=r;a<=h;a++)i.seq[e].group.push([a]);else for(r=int(i.seq[e].group),i.seq[e].group=[];r--;)i.seq[e].group.push([n++])}if(i.trans)for(var e in i.trans)for(var u in i.seq[e].trans=i.trans[e],i.trans[e])for(var l=0;l<i.trans[e][u].length;l++){var o=i.trans[e][u][l];if(!i.seq[o])throw new Error("Undefined sequence: "+o);i.trans[e][u][l]=i.seq[o]}i.initialized=!0}},getDrawable:function(s,i){return new e(this,s?this.a.seq[s]:this.a.def,i||this.a.fps)},getSequence:function(s){return s?this.a.seq[s]:this.a.def}});
},{"@rsthn/rin":"OHwo","./spritesheet":"vcfM","../system":"mu8O"}],"n7sr":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin"),h=require("../canvas");module.exports=t.extend({__ctor:function(t){if("image"!=t.type||!t.font)throw new Error("Resource is not a sprite font.");var h=t.data.width/t.font.sheetWidth,r=t.width/t.font.sheetWidth;this.r_charWidth=t.font.charWidth*h,this.r_charHeight=t.font.charHeight*h,this.charWidth=t.font.charWidth*r,this.charHeight=t.font.charHeight*r;var i=~~(t.font.sheetWidth/t.font.charWidth);this.r=t,this.r.wrapper=this;var a=t.font.charset.length,e=0,s=0;for(this.charTable={},this.charTable[" "]={charWidth:this.charWidth>>1,r_charWidth:this.r_charWidth};e<a;){for(var c=0,d=0;d<i&&e<a;d++){var n=t.font.charset[e++];this.charTable[n]={x:c,y:s,charWidth:this.charWidth,r_charWidth:this.r_charWidth},c+=this.r_charWidth}s+=this.r_charHeight}if(t.font.widths)for(a=t.font.widths.length,d=0;d<a;d+=2)for(var o=t.font.widths[d]*r,f=t.font.widths[d]*h,W=t.font.widths[d+1],g=0;g<W.length;g++)this.charTable[W[g]].charWidth=o,this.charTable[W[g]].r_charWidth=f},draw:function(t,h,r,i){for(var a=i.length,e=0;e<a;e++)if(" "!=i[e]){var s=this.charTable[i[e]];s&&(t.drawImage(this.r.data,s.x,s.y,s.r_charWidth,this.r_charHeight,h,r,s.charWidth,this.charHeight),h+=s.charWidth)}else h+=this.charTable[i[e]].charWidth},measureWidth:function(t){for(var h=t.length,r=0,i=0;i<h;i++){var a=this.charTable[t[i]];a&&(r+=a.charWidth)}return r},measureHeight:function(t){return this.charHeight}}),h.prototype.drawText=function(t,h,r,i){t.draw(this,h,r,i.toString())},h.prototype.drawTextAligned=function(t,h,r,i,a,e,s,c){c=c.toString(),0==e?h+=i-t.measureWidth(c)>>1:e<0?h=h-e-1:e>0&&(h=h+i-e+1-t.measureWidth(c)),0==s?r+=a-t.measureHeight(c)>>1:s<0?r=r-s-1:s>0&&(r=r+a-s+1-t.measureHeight(c)),t.draw(this,h,r,c)},h.prototype.drawTextAligned2=function(t,h,r,i,a){this.drawTextAligned(t,h.x1,h.y1,h.width(),h.height(),r,i,a)};
},{"@rsthn/rin":"OHwo","../canvas":"iBRc"}],"lJmq":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];const{Rin:a,Class:r}=require("@rsthn/rin"),t=module.exports=r.extend({r:null,__ctor:function(e){if("audio"!=e.type)throw new Error("Resource is not audio.");this.r=e,this.r.wrapper=this,this.track=t[this.r.track.toUpperCase()]},play:function(e,a){return t.play(this,e,a)},playLoop:function(e,a){return t.playLoop(this,e,a)}});t.ENGINE_HTML5=1,t.ENGINE_WEBAUDIO=2,t.ENGINE_NATIVEAUDIO=3,a.override(t,{MASTER:{enabled:!0,volume:1},SFX:{enabled:!0,volume:1},MUSIC:{enabled:!0,volume:.8},VOICE:{enabled:!0,volume:1},MAX_POOL_SIZE:100,pool:[],active:[],register:function(e){e.registered||(e.registered=!0,this.active.push(e))},unregister:function(e){if(e.registered){e.registered=!1;var a=t.active.indexOf(e);-1!=a&&t.active.splice(a,1)}},updateNode:function(e,a){switch(e.snd.r.engine){case t.ENGINE_WEBAUDIO:return this.updateNode_webaudio(e,a);case t.ENGINE_NATIVEAUDIO:return this.updateNode_nativeaudio(e,a)}return this.updateNode_audio(e,a)},alloc_webaudio:function(e){e.gainNode=audioContext.createGain(),e.gainNode.gain.value=0,e.gainNode.connect(audioContext.destination),e.res=audioContext.createBufferSource(),e.res.buffer=e.snd.r.data,e.res.loop=!1,e.res.connect(e.gainNode),e.res.node=e},free_webaudio:function(e){e.res&&(e.gainNode.disconnect(),e.res=null,e.gainNode=null)},alloc_nativeaudio:function(e){e.res=!0},free_nativeaudio:function(e){e.res=!1},alloc_audio:function(e){return this.pool.length?item=this.pool.pop():item=e.cloneNode(),item._src=e.src,item},free_audio:function(e){this.pool.length!=this.MAX_POOL_SIZE&&this.pool.push(e)},updateNode_webaudio:function(e,a){if(!e)return null;var r=t.MASTER.volume*e.snd.track.volume*e.volume;switch(a){case"play":if(e.playing)break;e.res||t.alloc_webaudio(e),e.playTime=hrnow(),e.playing=!0,e.pause=!1,e.res.onended=t.onended_webaudio,e.gainNode.gain.value=r;try{e.res.start(0,e.startTime/1e3)}catch(n){return t.free_webaudio(e),null}t.register(e);break;case"setvolume":if(!e.res)break;e.gainNode.gain.value=r;break;case"stop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1,t.free_webaudio(e),e.callback&&e.callback();break}if(!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1,e.res.onended=null,t.unregister(e),e.res.stop(),t.free_webaudio(e),e.callback&&e.callback();break;case"pause":if(!e.playing||!e.res)break;e.startTime+=hrnow()-e.playTime,e.playing=!1,e.pause=!0,e.res.onended=null,t.unregister(e),e.res.stop(),t.free_webaudio(e);break;case"softstop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1;break}if(!e.playing||!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1,e.res.loop=!1}return e},onended_webaudio:function(e){var a=e.currentTarget.node;if(a.playing&&0!=a.loop)return t.free_webaudio(a),-1!=a.loop&&a.loop--,a.startTime=0,a.playing=!1,a.pause=!1,void t.updateNode_webaudio(a,"play");a.res.onended=null,a.res.volume=0,t.updateNode_webaudio(a,"stop")},updateNode_nativeaudio:function(a,r){if(!a)return null;switch(r){case"play":if(a.playing)break;a.res||t.alloc_nativeaudio(a),a.playing=!0,a.pause=!1;try{e.plugins.NativeAudio.play(a.snd.r.data,null,null,function(){t.onended_nativeaudio(a)})}catch(n){return t.free_nativeaudio(a),null}t.register(a);break;case"setvolume":break;case"stop":if(!a.res)break;a.playing=!1,a.pause=!1,t.unregister(a),e.plugins.NativeAudio.stop(a.snd.r.data,null),t.free_nativeaudio(a),a.callback&&a.callback()}return a},onended_nativeaudio:function(e){t.updateNode_nativeaudio(e,"stop")},updateNode_audio:function(e,a){if(!e)return null;var r=t.MASTER.volume*e.snd.track.volume*e.volume;switch(a){case"play":if(e.playing)break;e.res||(e.res=t.alloc_audio(e.snd.r.data),e.res.node=e,e.res.src=e.res._src),e.playTime=hrnow(),e.playing=!0,e.pause=!1,e.res.onended=t.onended_audio,e.res.currentTime=e.startTime/1e3,e.res.volume=r;try{e.res.play()}catch(n){return t.free_audio(e.res),e.res=null,null}t.register(e);break;case"setvolume":if(!e.res)break;e.res.volume=r;break;case"stop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1,t.free_audio(e.res),e.res=null,e.callback&&e.callback();break}if(!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1,t.unregister(e),e.res.pause(),t.free_audio(e.res),e.res=null,e.callback&&e.callback();break;case"pause":if(!e.playing||!e.res)break;e.startTime+=hrnow()-e.playTime,e.playing=!1,e.pause=!0,t.unregister(e),e.res.pause();break;case"softstop":if(!e.playing&&e.paused){e.startTime=0,e.paused=!1;break}if(!e.playing||!e.res)break;e.startTime=0,e.playing=!1,e.pause=!1}return e},onended_audio:function(e){var a=e.currentTarget.node;if(a.playing&&0!=a.loop)return-1!=a.loop&&a.loop--,a.startTime=0,a.playing=!1,a.pause=!1,void t.updateNode_audio(a,"play");a.res.onended=null,a.res.volume=0,t.updateNode_audio(a,"stop")},enableTrack:function(e){e&&(e.enabled=!0)},disableTrack:function(e){e&&(e.enabled=!1)},setVolume:function(e,a){e&&(e.volume=a)},createNode:function(e,a){var r={};return r.startVolume=a,r.volume=a,r.snd=e,r.loop=0,r.playing=!1,r.paused=!1,r.startTime=0,r.playTime=0,r.callback=null,r.timer=null,r.res=null,r},play:function(e,a,r){if(!this.MASTER.enabled||!e||!e.track.enabled)return null;r=null!=r?r:1;var t=this.createNode(e,r);return t.callback=a,this.updateNode(t,"play")},playLoop:function(e,a,r){if(!this.MASTER.enabled||!e||!e.track.enabled)return null;r=null!=r?r:1;var t=this.createNode(e,r);return t.callback=a,t.loop=-1,this.updateNode(t,"play")},stop:function(e,a){return e?(a&&!0!==a&&(e.callback=a),this.updateNode(e,!0===a?"stop":"softstop")):null},pause:function(e){return e?this.updateNode(e,"pause"):null},resume:function(e){return e?this.updateNode(e,"play"):null},fadeOut:function(e,a,r){if(e)if(e.playing&&!e.timer){var n=hrnow();e.startVolume=e.volume,e.timer=setInterval(function(){var i=(hrnow()-n)/a;i>1&&(i=1),e.volume=e.startVolume*(1-i),t.updateNode(e,"setvolume"),1==i&&(clearInterval(e.timer),e.timer=null,!0===r?t.updateNode(e,"stop"):t.updateNode(e,"pause"),r&&!0!==r&&r())},50)}else r&&r()},fadeIn:function(e,a,r){if(e)if(e.playing||e.timer)r&&r();else{var n=hrnow();e.volume=0,this.updateNode(e,"play"),e.timer=setInterval(function(){var i=(hrnow()-n)/a;i>1&&(i=1),e.volume=e.startVolume*i,t.updateNode(e,"setvolume"),1==i&&(clearInterval(e.timer),e.timer=null,r&&r())},50)}}});
},{"@rsthn/rin":"OHwo"}],"HUlu":[function(require,module,exports) {
require("../globals");const{Rin:t,Class:s}=require("@rsthn/rin"),n=require("./sound");module.exports=s.extend({r:null,__ctor:function(s){if("audios"!=s.type)throw new Error("Resource is not audios.");this.r=s,this.r.wrapper=this,this.r.track||(this.r.track="sfx"),this.r.mode||(this.r.mode="random"),this.track=n[this.r.track.toUpperCase()],this.sounds=[],this.lastIndex=-1;for(var r=0;r<this.r.data.length;r++)this.sounds.push(new n(t.override(this.r.data[r],{track:this.r.track})))},getRandomSound:function(){return"random"==this.r.mode?this.sounds[randr(0,this.sounds.length-1)]:(this.lastIndex=++this.lastIndex%this.sounds.length,this.sounds[this.lastIndex])},play:function(t,s){return n.play(this.getRandomSound(),t,s)},playLoop:function(t,s){return n.playLoop(this.getRandomSound(),t,s)},playAt:function(t,s,r){return n.play(this.sounds[t%this.sounds.length],s,r)},playLoopAt:function(t,s,r){return n.playLoop(this.sounds[t%this.sounds.length],s,r)}});
},{"../globals":"JxzF","@rsthn/rin":"OHwo","./sound":"lJmq"}],"xNuh":[function(require,module,exports) {
module.exports={Drawable:require("./wrappers/drawable"),DrawableRect:require("./wrappers/drawable-rect"),SpriteSheet:require("./wrappers/spritesheet"),SpriteSheetAnimation:require("./wrappers/spritesheet-animation"),SpriteFont:require("./wrappers/spritefont"),Sound:require("./wrappers/sound"),SoundArray:require("./wrappers/sound-array")};
},{"./wrappers/drawable":"Uwqb","./wrappers/drawable-rect":"EU1j","./wrappers/spritesheet":"vcfM","./wrappers/spritesheet-animation":"tfUv","./wrappers/spritefont":"n7sr","./wrappers/sound":"lJmq","./wrappers/sound-array":"HUlu"}],"UcYf":[function(require,module,exports) {
var global = arguments[3];
var a=arguments[3];require("./globals");const{Rin:e}=require("@rsthn/rin"),t=require("./system"),r=require("./canvas"),i=require("./wrappers"),o=module.exports={integerScaling:!0,load:function(r,n,d,s,l){if(s||(s=Object.keys(r),r.__original=e.clone(r),l=0),n&&n(l,s.length,l/s.length),l!=s.length){var h=r[s[l]];switch(h.resName=s[l],h.type){case"image":h.data=new Image,h.data.onload=function(){var a=h.data.width/h.data.height;h.scale&&(h.width=~~(h.data.width*h.scale),h.height=~~(h.data.height*h.scale)),h.width||h.height?h.width&&!h.height?h.height=int(h.width/a):!h.width&&h.height&&(h.width=int(a*h.height)):(h.width=h.data.width,h.height=h.data.height),h.owidth=h.data.width,h.oheight=h.data.height,(h.data.width!=h.width||h.data.height!=h.height||!0!==h.original&&1!=t.scaleFactor)&&(!0===h.original?h.data=o.resizeImage(h,h.width,h.height,h.pixelated,!0):h.data=o.resizeImage(h,h.width*(h.pixelated?t.integerScaleFactor:t.scaleFactor),h.height*(h.pixelated?t.integerScaleFactor:t.scaleFactor),h.pixelated,!0)),h.rscale=h.data.width/h.width,t.tempDisplayBuffer.drawImage(h.data,0,0),t.displayBuffer.prepareImage(h.data),o.onLoaded(r,s[l]),o.load(r,n,d,s,l+1)},h.data.onerror=function(){console.error("Error: Unable to load: "+h.resName)},h.data.src=h.src+"?r="+Math.random();break;case"images":var c=(g=h.src).indexOf("#"),u=(f=g.lastIndexOf("#"))-c+1;if(-1==c)return void console.error("Unable to load: "+h.resName+"\nError: The 'src' attribute requires one or more '#' marks.");if(!h.count)return void console.error("Unable to load: "+h.resName+"\nError: The 'count' attribute was not found.");h._i=0,h.data=[],(m=function(){if(h._i==h.count)return o.onLoaded(r,s[l]),void o.load(r,n,d,s,l+1);var a={type:"image",width:h.width,height:h.height,scale:h.scale};a.src=h.src.substr(0,c)+(h._i++/Math.pow(10,u)).toFixed(u).substr(2)+h.src.substr(f+1),a.data=new Image,a.resName=h.resName+"#"+(h._i-1),a.data.onload=function(){var e=a.data.width/a.data.height;a.scale&&(a.width=~~(a.data.width*a.scale),a.height=~~(a.data.height*a.scale)),a.width||a.height?a.width&&!a.height?a.height=int(a.width/e):!a.width&&a.height&&(a.width=int(e*a.height)):(a.width=a.data.width,a.height=a.data.height),1==h._i&&(h.owidth=a.data.width,h.oheight=a.data.height),(a.data.width!=a.width||a.data.height!=a.height||!0!==a.original&&1!=t.scaleFactor)&&(!0===a.original?a.data=o.resizeImage(a,a.width,a.height,h.pixelated,!0):a.data=o.resizeImage(a,a.width*(h.pixelated?t.integerScaleFactor:t.scaleFactor),a.height*(h.pixelated?t.integerScaleFactor:t.scaleFactor),h.pixelated,!0)),a.rscale=a.data.width/a.width,1==h._i&&(h.width=a.width,h.height=a.height,h.rscale=a.rscale),t.tempDisplayBuffer.drawImage(a.data,0,0),t.displayBuffer.prepareImage(a.data),h.data.push(a),m()},a.data.onerror=function(){console.error("Error: Unable to load: "+a.resName)},a.data.src=a.src+"?r="+Math.random()})();break;case"audio":if(h.track||(h.track="sfx"),a.plugins&&a.plugins.NativeAudio&&"sfx"==h.track){h.engine=i.Sound.ENGINE_NATIVEAUDIO,h.data="snd_"+l,a.plugins.NativeAudio.preloadSimple(h.data,h.src,function(){o.onLoaded(r,s[l]),o.load(r,n,d,s,l+1)},function(a){console.error("Error: Unable to load (sfx): "+h.resName+"\n"+a)});break}if(a.audioContext){h.engine=i.Sound.ENGINE_WEBAUDIO,fetchAudioBuffer(h.src+"?r="+Math.random()).then(a=>{h.data=a,o.onLoaded(r,s[l]),o.load(r,n,d,s,l+1)}).catch(a=>{console.error("Error: Unable to load: "+h.resName)});break}h.data=new Audio,h.engine=i.Sound.ENGINE_HTML5,h.data.oncanplaythrough=function(){o.onLoaded(r,s[l]),o.load(r,n,d,s,l+1)},h.data.onerror=function(){console.error("Error: Unable to load: "+h.resName)},h.data.src=h.src+"?r="+Math.random();break;case"audios":var g,f,m;c=(g=h.src).indexOf("#"),u=(f=g.lastIndexOf("#"))-c+1;if(-1==c)return void console.error("Unable to load: "+h.resName+"\nError: The 'src' attribute requires one or more '#' marks.");if(!h.count)return void console.error("Unable to load: "+h.resName+"\nError: The 'count' attribute was not found.");h._i=0,h.data=[],(m=function(){if(h._i==h.count)return o.onLoaded(r,s[l]),void o.load(r,n,d,s,l+1);var e={type:"audio",track:h.track};return e.src=h.src.substr(0,c)+(h._i++/Math.pow(10,u)).toFixed(u).substr(2)+h.src.substr(f+1),e.resName=h.resName+"#"+(h._i-1),e.track||(e.track="sfx"),a.plugins&&a.plugins.NativeAudio&&"sfx"==e.track?(e.engine=i.Sound.ENGINE_NATIVEAUDIO,e.data="snd_"+l+"_"+h._i,void a.plugins.NativeAudio.preloadSimple(e.data,e.src,function(){h.data.push(e),m()},function(a){console.error("Error: Unable to load (sfx): "+e.resName+"\n"+a)})):a.audioContext?(e.engine=i.Sound.ENGINE_WEBAUDIO,void fetchAudioBuffer(e.src+"?r="+Math.random()).then(a=>{e.data=a,h.data.push(e),m()}).catch(a=>{console.error("Error: Unable to load: "+e.resName)})):(e.data=new Audio,e.engine=i.Sound.ENGINE_HTML5,e.data.oncanplaythrough=function(){h.data.push(e),m()},e.data.onerror=function(){console.error("Error: Unable to load: "+e.resName)},void(e.data.src=e.src+"?r="+Math.random()))})();break;case"json":fetchd(h.src+"?r="+Math.random(),{responseType:"json"}).then(function(a){h.data=a,o.onLoaded(r,s[l]),o.load(r,n,d,s,l+1)}).catch(function(a){console.error("Error: Unable to load: "+h.resName+". Error: "+a)});break;case"object":h.data={},o.onLoaded(r,s[l]),o.load(r,n,d,s,l+1)}}else d&&d(r)},unload:function(a){var e;for(var t in a)if("__original"!=t){switch(a[t].r&&(dispose(a[t]),a[t]=a[t].r),a[t].type){case"audio":case"audios":break;case"images":for(var r=0;r<a[t].data.length;r++)dispose(a[t].data[r]);break;default:dispose(a[t].data)}a[t].data=null,delete a[t]}else e=a[t],delete a[t];for(var t in e)a[t]=e[t]},onLoaded:function(a,e){var t=a[e];t.wrapper&&t.wrapper in i&&(a[e]=new i[t.wrapper](t))},resizeImage:function(a,e,t,i,o){var n=a.data.width,d=a.data.height;if(e=int(e),t=int(t),n==e&&d==t)return a.data;if(!this.integerScaling&&i&&(i=null),i){if(~~(e/n)>0){var s,l=~~(e/n+.9),h=(e=l*n)/n,c=(t=l*d)/d;w=new r(null,{hidden:!0,antialias:!1}).resize(e,t);(s=new r(null,{hidden:!0,antialias:!1}).resize(n,d)).drawImage(a.data,0,0);for(var u=0;u<d;u++)for(var g=s.getImageData(0,u,n,1).data,f=0,m=0;m<n&&f<g.length;m++,f+=4)w.fillStyle("rgba("+g[f]+","+g[f+1]+","+g[f+2]+","+g[f+3]/255+")"),w.fillRect(m*h,u*c,h,c);return s.dispose(),w.elem}return this.resizeImage(a,e,t,null,o)}for((s=new r(null,{hidden:!0,antialias:i=null!==i}).resize(n,d)).drawImage(a.data,0,0);;){var w,p=n>>1,b=d>>1;if(p<=e||b<=t)break;(w=new r(null,{hidden:!0,antialias:i}).resize(p,b)).drawImage(s.elem,0,0,p,b),s.dispose(),n=p,d=b,s=w}return(w=new r(null,{hidden:!0,antialias:i}).resize(e,t)).drawImage(s.elem,0,0,e,t),s.dispose(),o&&dispose(a.data),w.elem},flipImageHorz:function(a){var e=new r(null,{hidden:!0}).resize(a.data.width,a.data.height);return e.translate(a.data.width,0),e.scale(-1,1),e.drawImage(a.data,0,0),e.elem},showDownload:function(a,e){var t=document.createElement("a");t.href=e,t.style.display="none",t.download=a,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},showFilePicker:function(a,e,t){var r=document.createElement("input");r.type="file",r.accept=e,r.style.display="none",r.multiple=a,document.body.appendChild(r),r.onchange=function(){t(r.files)},document.body.onfocus=function(){document.body.onfocus=null,document.body.removeChild(r)},r.click()},loadAsDataURL:function(a,e){var t=new FileReader;t.onload=function(a){e(a.target.result)},t.readAsDataURL(a)},loadAsText:function(a,e){var t=new FileReader;t.onload=function(a){e(a.target.result)},t.readAsText(a)},loadAsArrayBuffer:function(a,e){var t=new FileReader;t.onload=function(a){e(a.target.result)},t.readAsArrayBuffer(a)},loadAllAsDataURL:function(a,e){var t=[];if(a&&a.length){var r=function(i){i!=a.length?o.loadAsDataURL(a[i],function(e){t.push({name:a[i].name,size:a[i].size,url:e}),r(i+1)}):e(t)};r(0)}else e(t)}};
},{"./globals":"JxzF","@rsthn/rin":"OHwo","./system":"mu8O","./canvas":"iBRc","./wrappers":"xNuh"}],"KwpD":[function(require,module,exports) {
const{Class:t}=require("@rsthn/rin"),s=require("./rect"),n=module.exports=t.extend({className:"QuadTreeItem",insertionBounds:null,lastBounds:null,bounds:null,lbounds:null,type:0,zindex:0,visible:!0,flags:0,numRefNodes:0,tag:null,__ctor:function(){this.insertionBounds=s.alloc(),this.lastBounds=s.alloc(),this.bounds=s.alloc(),this.lbounds=s.alloc(),this.numRefNodes=0,this.zindex=0,this.flags=n.FLAG_INITIAL,this.visible=!0},__reinit:function(){this.insertionBounds.zero(),this.lastBounds.zero(),this.bounds.zero(),this.lbounds.zero(),this.numRefNodes=0,this.zindex=0,this.flags=n.FLAG_INITIAL,this.visible=!0,this.type=0,this.tag=null},__dtor:function(){},setFlags:function(t){this.flags|=t},clearFlags:function(t){this.flags&=~t},getFlags:function(t){return this.flags&t},setTag:function(t){this.tag=t},getTag:function(){return this.tag},setZIndex:function(t){return this.zindex=t,this},getZIndex:function(){return this.zindex},notifyInserted:function(t){this.flags|=n.FLAG_ATTACHED,this.insertionBounds.set(this.getBounds()),this.flags&n.FLAG_INITIAL&&(this.flags&=~n.FLAG_INITIAL,this.lastBounds.set(this.getBounds()))},notifyRemoved:function(t){this.flags&=~n.FLAG_ATTACHED},notifyPosition:function(){this.lastBounds.set(this.getBounds())},getInsertionBounds:function(){return this.insertionBounds},getLastBounds:function(){return this.lastBounds},getBounds:function(){return this.bounds},getLBounds:function(){return this.lbounds},setType:function(t){return this.type=t,this},getType:function(){return this.type},setVisible:function(t){return this.visible=t,this},getVisible:function(){return this.visible}});n.FLAG_QUEUED=1,n.FLAG_ATTACHED=2,n.FLAG_SELECTED=4,n.FLAG_INITIAL=8,n.FLAG_ALWAYS_SELECT=16,n.FLAG_CHILD=32,n.FLAG_USERDEF=64;
},{"@rsthn/rin":"OHwo","./rect":"Z3Eu"}],"Ygob":[function(require,module,exports) {
require("./globals");const{Class:t}=require("@rsthn/rin"),e=require("./rect"),s=require("./quadtree-item"),i=module.exports=t.extend({className:"QuadTreeNode",extents:null,numItems:0,insertionPoint:null,subNode:null,isDirty:!1,tree:null,__ctor:function(t,s,i,n,o){this.tree=t,this.numItems=0,this.isDirty=!1,this.insertionPoint=null,this.subNode=null,this.extents=e.alloc(s,i,n,o)},__dtor:function(){if(null!=this.subNode){for(var t=0;t<4;t++)dispose(this.subNode[t]);this.subNode=null}this.extents.dispose()},clear:function(){if(null!=this.subNode){for(var t=0;t<4;t++)this.subNode[t].clear(this.tree.items),dispose(this.subNode[t]);this.subNode=null,this.numItems=0}else{var e=null;for(t=this.insertionPoint;t&&this.numItems--;t=e){e=t.next;var s=this.tree.items.remove(t);s.numRefNodes--,0==s.numRefNodes&&(s.notifyRemoved(this.tree),dispose(s))}this.insertionPoint=null,this.numItems=0}},getExtents:function(){return this.extents},addItem:function(t,e){if(!t.getBounds().intersects(this.extents))return!1;if(null!=this.subNode){for(var s=!1,n=0;n<4;n++)s|=this.subNode[n].addItem(t,e);return s&&(this.isDirty=!0,this.numItems++),s}if(this.numItems<e)return null==this.insertionPoint?(this.tree.items.push(t),this.insertionPoint=this.tree.items.bottom):this.tree.items.insertAfter(this.insertionPoint,t),this.isDirty=!0,this.numItems++,0==t.numRefNodes&&t.notifyInserted(this.tree),t.numRefNodes++,!0;if(this.extents.width()<1&&this.extents.height()<1)return console.log("Error: Unable to split node any further. Current size is "+this.extents.width()+" x "+this.extents.height()),!1;this.subNode=[new i(this.tree,this.extents.x1,this.extents.y1,this.extents.cx,this.extents.cy),new i(this.tree,this.extents.cx,this.extents.y1,this.extents.x2,this.extents.cy),new i(this.tree,this.extents.x1,this.extents.cy,this.extents.cx,this.extents.y2),new i(this.tree,this.extents.cx,this.extents.cy,this.extents.x2,this.extents.y2)];let o=this.numItems;this.numItems=0;for(let i=0;i<o;i++){let t=this.insertionPoint.next,s=this.insertionPoint.value;s.numRefNodes--,this.addItem(s,e)||console.log("Error: Shouldn't have happened. Unable to insert item on a sub-node of a just-split node."),this.tree.items.remove(this.insertionPoint),this.insertionPoint=t}return this.insertionPoint=null,this.addItem(t,e)},removeItem:function(t){if(!t.getInsertionBounds().intersects(this.extents))return!1;if(null!=this.subNode){for(var e=!1,s=0;s<4;s++)e|=this.subNode[s].removeItem(t);return e&&(this.isDirty=!0,this.numItems--),e}s=this.insertionPoint;for(var i=this.numItems;s&&i--&&s.value!=t;s=s.next);return null!=s&&(this.isDirty=!0,this.numItems--,t.numRefNodes--,s===this.insertionPoint&&(this.insertionPoint=this.numItems?s.next:null),this.tree.items.remove(s),0==t.numRefNodes&&t.notifyRemoved(this.tree),!0)},selectItems:function(t){if(t.intersects(this.extents))if(null!=this.subNode)for(var e=0;e<4;e++)this.subNode[e].selectItems(t);else{e=this.insertionPoint;for(var i=this.numItems;e&&i--;e=e.next)(1==e.value.visible&&e.value.getInsertionBounds().intersects(t)||e.value.flags&s.FLAG_ALWAYS_SELECT)&&(e.value.flags|=s.FLAG_SELECTED)}},detectCollisions:function(t,e){if(this.isDirty)if(this.isDirty=!1,null==this.subNode){var s=this.numItems;for(m=this.insertionPoint;m&&s>1;m=i){var i=m.next,n=--s;if(0!=m.value.visible&&t.onFilterRequest(m.value,e))for(var o=m.value.getLBounds(),r=m.next;r&&n-- >0;r=u){var u=r.next;if(0!=r.value.visible&&(t.onFilterRequest(r.value,e)&&r.value.getLBounds().intersects(o))){var h=m.objectId,l=r.objectId;if(t.onCollision(m.value,r.value,e),m.objectId!=h){i=this.insertionPoint,s=this.numItems;break}r.objectId==l||(u=m.next,n=s)}}}}else for(var m=0;m<4;m++)this.subNode[m].detectCollisions(t,e)}});
},{"./globals":"JxzF","@rsthn/rin":"OHwo","./rect":"Z3Eu","./quadtree-item":"KwpD"}],"lu8c":[function(require,module,exports) {
require("./globals");const{Class:e}=require("@rsthn/rin"),t=require("./list"),i=require("./quadtree-node"),s=require("./quadtree-item"),n=module.exports=e.extend({className:"QuadTree",root:null,items:null,orderedItems:null,updateQueue:null,nodeCapacity:0,nextItem:null,isReverse:!1,visible:!0,xd:!1,yd:!1,zd:!1,__ctor:function(e,s,n,r,d){this.items=new t,this.orderedItems=new t,this.updateQueue=new t,this.root=new i(this,e,s,n,r),this.nodeCapacity=d,this.isReverse=!1,this.visible=!0,this.fnComparator=this.COMPARATOR_DEFAULT_YX},__dtor:function(){this.root.clear(),dispose(this.root),dispose(this.items),dispose(this.orderedItems),dispose(this.updateQueue)},getExtents:function(){return this.root.getExtents()},setVisible:function(e){return this.visible=e,this},getVisible:function(){return this.visible},clear:function(){this.root.clear(),this.orderedItems.reset(),this.updateQueue.reset()},setXd:function(e){return this.xd!=e&&(this.xd=e,!0)},setYd:function(e){return this.yd!=e&&(this.yd=e,!0)},setZd:function(e){return this.zd!=e&&(this.zd=e,!0)},getXd:function(){return this.xd},getYd:function(){return this.yd},getZd:function(){return this.zd},fnComparator:null,setComparator:function(e){return this.fnComparator!=e&&(this.fnComparator=e,!0)},COMPARATOR_DEFAULT_YX:function(e,t,i,s){return i.zindex<s.zindex^this.zd||i.zindex==s.zindex&&(e.y1<t.y1^this.yd||e.y1==t.y1&&e.x1<t.x1^this.xd)},COMPARATOR_DEFAULT_XY:function(e,t,i,s){return i.zindex<s.zindex^this.zd||i.zindex==s.zindex&&(e.x1<t.x1^this.xd||e.x1==t.x1&&e.y1<t.y1^this.yd)},COMPARATOR_MANHATTAN:function(e,t,i,s){return i.zindex<s.zindex^this.zd||i.zindex==s.zindex&&e.cx+e.cy<t.cx+t.cy},COMPARATOR_Y2:function(e,t,i,s){return i.zindex<s.zindex^this.zd||i.zindex==s.zindex&&(e.y2<t.y2^this.yd||e.y2==t.y2&&e.x1<=t.x1^this.xd)},COMPARATOR_Y1:function(e,t,i,s){return e.y1+i.zindex<t.y1+s.zindex^this.yd},COMPARATOR_X2:function(e,t,i,s){return e.x2+i.zindex<t.x2+s.zindex^this.xd},COMPARATOR_X1:function(e,t,i,s){return e.x1+i.zindex<t.x1+s.zindex^this.xd},isBefore:function(e,t){return this.fnComparator(e.getLBounds(),t.getLBounds(),e,t)},addItemOrdered:function(e){for(var t=this.orderedItems.top;t;t=t.next)if(this.isBefore(e,t.value))return void this.orderedItems.insertBefore(t,e);this.orderedItems.push(e)},reorderItems:function(){var e=this.orderedItems;this.orderedItems=new t;for(var i=e.top;i;i=i.next)this.addItemOrdered(i.value);dispose(e)},addItem:function(e){return!!this.root.addItem(e,this.nodeCapacity)&&(this.addItemOrdered(e),!0)},removeItem:function(e){return!(e.flags&s.FLAG_ATTACHED)||!!this.root.removeItem(e)&&(this.orderedItems.remove(this.orderedItems.sgetNode(e)),!0)},updateItem:function(e){this.removeItem(e),this.addItem(e)?e.flags&s.FLAG_QUEUED||(this.updateQueue.push(e),e.flags|=s.FLAG_QUEUED):dispose(e,"QuadTree::updateItem")},update:function(){for(var e;e=this.updateQueue.pop();)e.flags&=~s.FLAG_QUEUED,e.notifyPosition()},getItems:function(){return this.orderedItems},setReverse:function(e){return this.isReverse=e,this},selectItems:function(e,t=null){null===t&&(t=this.isReverse),this.root.selectItems(e),this.nextItem=t?this.orderedItems.bottom:this.orderedItems.top},getNextSelectedItem:function(e=null){for(null===e&&(e=this.isReverse);null!=this.nextItem&&!(this.nextItem.value.flags&s.FLAG_SELECTED);)this.nextItem=e?this.nextItem.prev:this.nextItem.next;var t=this.nextItem;return this.nextItem&&(this.nextItem.value.flags&=~s.FLAG_SELECTED,this.nextItem=e?this.nextItem.prev:this.nextItem.next),t?t.value:null},detectCollisions:function(e,t){for(var i=16;this.root.isDirty&&0!=--i;)this.root.detectCollisions(e,t);0==i&&console.log("Error: Collision detection generated an unresolved state.")}});
},{"./globals":"JxzF","@rsthn/rin":"OHwo","./list":"LwHP","./quadtree-node":"Ygob","./quadtree-item":"KwpD"}],"yaFi":[function(require,module,exports) {
const t=require("./quadtree-item"),s=require("./display-element"),e=module.exports=t.extend({parent:null,__ctor:function(e,n,i,r,u){this._super.QuadTreeItem.__ctor(),this.parent=e,this.setFlags(s.FLAG_FRAGMENT|t.FLAG_CHILD),this.setType(e.getType()),this.bounds.set(e.bounds),this.lbounds.set(e.bounds),this.bounds.translate(n,i),this.lbounds.translate(n,i),this.bounds.resize(r,u,!1,!0),this.lbounds.resize(r,u,!1,!0)},translate:function(t,s){this.bounds.translate(t,s),this.lbounds.translate(t,s)}});
},{"./quadtree-item":"KwpD","./display-element":"JBY7"}],"JBY7":[function(require,module,exports) {
const t=require("./quadtree-item"),e=require("./fragment"),s=require("./list"),i=module.exports=t.extend({className:"DisplayElement",layer:null,fragments:null,x:0,y:0,scrX:0,scrY:0,related:null,parent:null,__ctor:function(t,e){this._super.QuadTreeItem.__ctor(),this.layer=null,this.setPosition(0,0),this.resize(t,e)},__reinit:function(t,e){this._super.QuadTreeItem.__reinit(),this.layer=null,this.setPosition(0,0),this.resize(t,e)},__dtor:function(){if(null!=this.fragments&&null!=this.layer)for(let t=this.fragments.top;t;t=t.next)this.layer.removeItem(t.value);null!=this.fragments&&dispose(this.fragments),null!=this.related&&dispose(this.related),null!=this.layer&&this.layer.removeItem(this),this._super.QuadTreeItem.__dtor()},dispose:function(){this.__dtor()},resize:function(t,e){this.bounds.resize(t,e,!1,!0),this.lbounds.resize(t,e,!1,!0)},notifyInserted:function(t){if(this._super.QuadTreeItem.notifyInserted(t),t){if(null!=this.layer&&this.layer!==t&&(this.layer.removeItem(this),null!=this.fragments))for(let t=this.fragments.top;t;t=t.next)this.layer.removeItem(t.value);if(this.layer=t,null!=this.fragments)for(let t=this.fragments.top;t;t=t.next)this.layer.addItem(t.value)}},notifyRemoved:function(t){if(null!=this.fragments)for(let e=this.fragments.top;e;e=e.next)this.layer.removeItem(e.value);this.layer=null},setLayer:function(t){return t.addItem(this),this},remove:function(){return this.layer?(this.layer.removeItem(this),this):this},setVisible:function(t){if(this._super.QuadTreeItem.setVisible(t),null!=this.fragments)for(let e=this.fragments.top;e;e=e.next)e.value.setVisible(t);return this},setRelated:function(t){return this.related=t,this.related.parent=this,this},addFragment:function(t,i,n,r){null==this.fragments&&(this.fragments=new s);let h=new e(this,t,i,n,r);return this.fragments.push(h),null!=this.layer&&this.layer.addItem(h),this},getNumFragments:function(){return null!=this.fragments?this.fragments.count:0},getFragments:function(){return this.fragments},onPositionChanged:function(t,e,s){var i=t-this.bounds.x1,n=e-this.bounds.y1,r=s-this.zindex;if(this.x+=i,this.y+=n,this.zindex+=r,this.scrX=this.x,this.scrY=this.y,this.bounds.translate(i,n),this.lbounds.translate(i,n),null!=this.layer&&this.layer.updateItem(this),null!=this.fragments&&null!=this.layer)for(let h=this.fragments.top;h;h=h.next)h.value.translate(i,n),this.layer.updateItem(h.value);null!=this.related&&this.related.translate(i,n)},setBounds:function(t){return this.onPositionChanged(t.x1,t.y1,this.zindex),this.resize(t.width(),t.height()),this},setPosition:function(t,e,s=!1){return 1==s&&(t+=this.bounds.x1-this.bounds.cx,e+=this.bounds.y1-this.bounds.cy),this.onPositionChanged(t,e,this.zindex),this},getScrX:function(){return this.scrX},getScrY:function(){return this.scrY},setX:function(t){return this.onPositionChanged(t,this.bounds.y1,this.zindex),this},setY:function(t){return this.onPositionChanged(this.bounds.x1,t,this.zindex),this},getX:function(){return this.x},getY:function(){return this.y},translate:function(t,e,s=0){return this.onPositionChanged(this.bounds.x1+t,this.bounds.y1+e,this.zindex+s),this},update:function(t){},draw:function(t){}});i.FLAG_FRAGMENT=1*t.FLAG_USERDEF,i.FLAG_HOLLOW=2*t.FLAG_USERDEF,Object.assign(exports,module.exports);
},{"./quadtree-item":"KwpD","./fragment":"yaFi","./list":"LwHP"}],"Z0pF":[function(require,module,exports) {
const t=require("./rect"),s=module.exports=function(s,i,h,e,o,r,n,c){this.focusFactorX=null==n?.4:n,this.focusFactorY=null==c?.4:c,this.focusTarget=null,this.sx=s,this.sy=i,h>o&&(h=o),e>r&&(e=r),this.width=h>>1,this.height=e>>1,o>>=1,r>>=1,this.worldX1=-o,this.worldY1=-r,this.worldX2=+o,this.worldY2=+r,this.bounds=t.alloc(),this.focusBounds=t.alloc(),this.screenBounds=t.alloc(),this.x=0,this.y=0,this.enabled=!0,this.updateScreenBounds(),this.updateBounds()};s.prototype.width=0,s.prototype.height=0,s.prototype.sx=0,s.prototype.sy=0,s.prototype.x=0,s.prototype.y=0,s.prototype.centerRatioX=0,s.prototype.centerRatioY=0,s.prototype.dx=0,s.prototype.dy=0,s.prototype.worldX1=0,s.prototype.worldY1=0,s.prototype.worldX2=0,s.prototype.worldY2=0,s.prototype.focusFactorX=0,s.prototype.focusFactorY=0,s.prototype.focusTarget=null,s.prototype.enabled=!1,s.prototype.scale=1,s.prototype.isEnabled=function(){return this.enabled},s.prototype.setEnabled=function(t){return this.enabled=t,this},s.prototype.updateBounds=function(){this.bounds.set(this.x-this.width/this.scale+this.dx,this.y-this.height/this.scale+this.dy,this.x+this.width/this.scale+this.dx,this.y+this.height/this.scale+this.dy),this.focusBounds.set(this.x-(this.focusFactorX*this.width+this.centerRatioX*this.width)/this.scale,this.y-(this.focusFactorY*this.height+this.centerRatioY*this.height)/this.scale,this.x+(this.focusFactorX*this.width+this.centerRatioX*this.width)/this.scale,this.y+(this.focusFactorY*this.height+this.centerRatioY*this.height)/this.scale)},s.prototype.updateScreenBounds=function(){this.screenBounds.set(this.sx,this.sy,this.sx+(this.width<<1),this.sy+(this.height<<1))},s.prototype.resize=function(t,s){return this.width=t>>1,this.height=s>>1,this.updateScreenBounds(),this.updateBounds(),this},s.prototype.setPosition=function(t,s,i=!1){return!0===i?(this.x=t,this.y=s,this.dx=this.dy=0):(this.dx=t,this.dy=s),this.updateBounds(),this},s.prototype.setScale=function(t){return this.scale=t,this.updateScreenBounds(),this.updateBounds(),this},s.prototype.setCenter=function(t,s){return this.centerRatioX=t,this.centerRatioY=s,this},s.prototype.translate=function(t,s){return this.dx+=t,this.dy+=s,this.updateBounds(),this},s.prototype.setScreenPosition=function(t,s){this.sx=t,this.sy=s,this.updateScreenBounds()},s.prototype.getX=function(t=!1){return this.x+(t?0:this.dx)},s.prototype.getY=function(t=!1){return this.y+(t?0:this.dy)},s.prototype.getPositionX=function(){return this.dx},s.prototype.getPositionY=function(){return this.dy},s.prototype.getWidth=function(){return this.width<<1},s.prototype.getHeight=function(){return this.height<<1},s.prototype.getBounds=function(){return this.bounds},s.prototype.getScreenBounds=function(){return this.screenBounds},s.prototype.getFocusBounds=function(){return this.focusBounds},s.prototype.focusOn=function(t,s,i,h){void 0===i&&(i=this.focusFactorX),void 0===h&&(h=this.focusFactorY);let e=this.x-(i*this.width+this.centerRatioX*this.width)/this.scale,o=this.x+(i*this.width+this.centerRatioX*this.width)/this.scale,r=this.y-(h*this.height+this.centerRatioY*this.height)/this.scale,n=this.y+(h*this.height+this.centerRatioY*this.height)/this.scale,c=this.x,u=this.y;t<e?c+=t-e:t>o&&(c+=t-o),s<r?u+=s-r:s>n&&(u+=s-n),e=c-this.width,o=c+this.width,r=u-this.height,n=u+this.height,e<this.worldX1&&(c=this.worldX1+this.width),o>this.worldX2&&(c=this.worldX2-this.width),r<this.worldY1&&(u=this.worldY1+this.height),n>this.worldY2&&(u=this.worldY2-this.height),this.x=c,this.y=u,this.updateBounds()},s.prototype.update=function(t){null!=this.focusTarget&&this.focusOn(this.focusTarget.getX(),this.focusTarget.getY())},s.prototype.setFocusTarget=function(t){return this.focusTarget=t,this},s.prototype.setFocusFactor=function(t,s){return this.focusFactorX=t,this.focusFactorY=void 0===s?t:s,this},s.prototype.applyTransform=function(t){t.translate(~~this.screenBounds.cx,~~this.screenBounds.cy),t.scale(this.scale,this.scale),t.translate(-~~this.getX(),-~~this.getY())},s.prototype.toWorldSpace=function(t,s){return{x:t=(t-~~this.screenBounds.cx)/this.scale+~~this.getX(),y:s=(s-~~this.screenBounds.cy)/this.scale+~~this.getY()}},s.prototype.toScreenSpace=function(t,s){return{x:t=(t-~~this.getX())*this.scale+~~this.screenBounds.cx,y:s=(s-~~this.getY())*this.scale+~~this.screenBounds.cy}};
},{"./rect":"Z3Eu"}],"XEkr":[function(require,module,exports) {
require("./globals");const{Class:e}=require("@rsthn/rin"),t=require("./rect"),u=require("./list"),s=require("./quadtree"),i=require("./viewport"),r=require("./system"),n=require("./display-element"),o=module.exports=e.extend({rect:null,bounds:null,numViewports:0,viewports:null,worldWidth:0,worldHeight:0,numLayers:0,layers:null,debugLBounds:null,onLayerDrawn:null,updateQueue:null,drawQueue:null,fullClear:!0,drawHollow:!1,__ctor:function(e,n,o,a,d){void 0===d&&(d=.2),this.numLayers=n,this.numViewports=e,this.worldWidth=o,this.worldHeight=a;var l=o+0>>1,h=a+0>>1,p=-l,c=l,y=-h,w=h;this.layers=[],this.viewports=[],this.debugLBounds=[],this.updateQueue=new u,this.drawQueue=new u,this.onLayerDrawn=[];for(var g=0;g<n;g++)this.layers[g]=new s(p,y,c,w,16),this.debugLBounds[g]=!1;for(g=0;g<e;g++)this.viewports[g]=new i(0,0,r.screenWidth,r.screenHeight,o,a,d);this.bounds=t.alloc(o,a),this.rect=t.alloc()},__dtor:function(){for(var e=0;e<this.numLayers;e++)dispose(this.layers[e]);for(e=0;e<this.numViewports;e++)dispose(this.viewports[e]);dispose(this.updateQueue),dispose(this.drawQueue)},getWidth:function(){return this.worldWidth},getHeight:function(){return this.worldHeight},getViewport:function(e){return e<0||e>=this.numViewports?null:this.viewports[e]},getBounds:function(){return this.bounds},getLayer:function(e){return e<0||e>=this.numLayers?null:this.layers[e]},updateQueueAdd:function(e){this.updateQueue.push(e)},updateQueueRemove:function(e){this.updateQueue.remove(this.updateQueue.sgetNode(e))},drawQueueAdd:function(e){this.drawQueue.push(e)},drawQueueRemove:function(e){this.drawQueue.remove(this.drawQueue.sgetNode(e))},queueAdd:function(e){this.drawQueue.push(e),this.updateQueue.push(e)},queueRemove:function(e){this.drawQueue.remove(this.drawQueue.sgetNode(e)),this.updateQueue.remove(this.updateQueue.sgetNode(e))},draw:function(e){this.fullClear&&e.clear(!0);for(var t=0;t<this.numViewports;t++){var u=this.viewports[t];if(!u.isEnabled())continue;e.save();let o=u.getScreenBounds();e.beginPath(),e.rect(o.x1,o.y1,o.width(),o.height()),e.clip(),e.pushMatrix(),u.applyTransform(e),this.rect.set(u.getBounds());for(var s=0;s<this.numLayers;s++){var i=this.layers[s];if(i.getVisible()){for(i.selectItems(this.rect),i.selectedCount=0;null!=(r=i.getNextSelectedItem());)r.getFlags(n.FLAG_FRAGMENT)||r.getFlags(n.FLAG_HOLLOW)&&!0!==this.drawHollow||(i.selectedCount++,r.draw(e),this.debugLBounds[s]&&(e.fillStyle("rgba(255,0,255,0.25)"),e.fillRect(r.lbounds.x1,r.lbounds.y1,r.lbounds.width(),r.lbounds.height())));this.onLayerDrawn[s]&&this.onLayerDrawn[s](e)}}e.popMatrix(),e.restore()}for(var r=this.drawQueue.top;r;r=r.next)r.value.draw(e)},update:function(e,t){this.updateElems(e,t),this.onUpdated(e,t),this.updateLayers(),this.updateViewports(e,t)},onUpdated:function(e,t){},updateElems:function(e,t){for(var u=this.updateQueue.top;u;u=u.next)u.value._used=!1;let s=this.updateQueue.count;for(u=this.updateQueue.top;u;)!0!==u.value._used?(u.value._used=!0,u.value.update(e,t),this.updateQueue.count==s?u=u.next:(s=this.updateQueue.count,u=this.updateQueue.top)):u=u.next},updateViewports:function(e,t){for(var u=0;u<this.numViewports;u++){var s=this.viewports[u];s.isEnabled()&&s.update(e,t)}},updateLayers:function(){for(var e=0;e<this.numLayers;e++)this.layers[e].update()},truncatePosition:function(e){var t=e.getBounds(),u=0;return t.x2>this.bounds.x2&&(e.translate(this.bounds.x2-t.x2,0),u|=8),t.y2>this.bounds.y2&&(e.translate(0,this.bounds.y2-t.y2),u|=2),t.x1<this.bounds.x1&&(e.translate(this.bounds.x1-t.x1,0),u|=4),t.y1<this.bounds.y1&&(e.translate(0,this.bounds.y1-t.y1),u|=1),u},moveToContact:function(e,t){var u=e.getLBounds(),s=t.getLBounds(),i=e.getLastBounds(),r=e.getBounds();i=this.rect.set(u).translate(i.x1-r.x1,i.y1-r.y1),(new Vec2).set(e.getVelocity());var n=u.y2==i.y2?-1:(s.y1-i.y2)/(u.y2-i.y2),o=u.y1==i.y1?-1:(s.y2-i.y1)/(u.y1-i.y1),a=u.x1==i.x1?-1:(s.x2-i.x1)/(u.x1-i.x1),d=u.x2==i.x2?-1:(s.x1-i.x2)/(u.x2-i.x2),l=0;switch((o<0||o>1)&&(o=1048576),(n<0||n>1)&&(n=1048576),(a<0||a>1)&&(a=1048576),(d<0||d>1)&&(d=1048576),1048576!=o&&o<n&&o<a&&o<d?l="D_TOP":1048576!=n&&n<a&&n<d?l="D_BOTTOM":1048576!=a&&a<d?l="D_LEFT":1048576!=d&&(l="D_RIGHT"),l){case"D_TOP":e.translate(0,s.y2-u.y1),e.getVelocity().y=0;break;case"D_BOTTOM":e.translate(0,s.y1-u.y2),e.getVelocity().y=0;break;case"D_LEFT":e.translate(s.x2-u.x1,0),e.getVelocity().x=0;break;case"D_RIGHT":e.translate(s.x1-u.x2,0),e.getVelocity().x=0}}});o.T_TOP=1,o.T_BOTTOM=2,o.T_LEFT=4,o.T_RIGHT=8;
},{"./globals":"JxzF","@rsthn/rin":"OHwo","./rect":"Z3Eu","./list":"LwHP","./quadtree":"lu8c","./viewport":"Z0pF","./system":"mu8O","./display-element":"JBY7"}],"DjYU":[function(require,module,exports) {
const n=module.exports={Linear:{IN:function(n){return n},OUT:function(n){return n},IN_OUT:function(n){return n}},Back:{k:1.70158,IN:function(t,u){return void 0===u&&(u=n.Back.k),t*t*((u+1)*t-u)},OUT:function(t,u){return 1-n.Back.IN(1-t,u)},IN_OUT:function(t,u){return t<.5?n.Back.IN(2*t,u)/2:n.Back.OUT(2*(t-.5),u)/2+.5}},Bounce:{getConst:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},IN:function(t){return 1-n.Bounce.getConst(1-t)},OUT:function(t){return n.Bounce.getConst(t)},IN_OUT:function(t){return t<.5?(1-n.Bounce.getConst(1-2*t))/2:n.Bounce.getConst(2*(t-.5))/2+.5}},Circ:{IN:function(n){return 1-Math.sqrt(1-n*n)},OUT:function(t){return 1-n.Circ.IN(1-t)},IN_OUT:function(t){return t<.5?n.Circ.IN(2*t)/2:n.Circ.OUT(2*(t-.5))/2+.5}},Cubic:{IN:function(n){return n*n*n},OUT:function(t){return 1-n.Cubic.IN(1-t)},IN_OUT:function(t){return t<.5?n.Cubic.IN(2*t)/2:n.Cubic.OUT(2*(t-.5))/2+.5}},Expo:{IN:function(n){return Math.pow(2,12*(n-1))},OUT:function(n){return 1-Math.pow(2,-12*n)},IN_OUT:function(n){return(n*=2)<1?Math.pow(2,12*(n-1))/2:(2-Math.pow(2,-12*(n-1)))/2}},Power:{p:12,IN:function(t){return Math.pow(t,n.Power.p)},OUT:function(t){return 1-n.Power.IN(1-t)},IN_OUT:function(t){return t<.5?n.Power.IN(2*t)/2:n.Power.OUT(2*(t-.5))/2+.5}},Quad:{IN:function(n){return n*n},OUT:function(t){return 1-n.Quad.IN(1-t)},IN_OUT:function(t){return t<.5?n.Quad.IN(2*t)/2:n.Quad.OUT(2*(t-.5))/2+.5}},Quartic:{IN:function(n){return n*n*n*n},OUT:function(t){return 1-n.Quartic.IN(1-t)},IN_OUT:function(t){return t<.5?n.Quartic.IN(2*t)/2:n.Quartic.OUT(2*(t-.5))/2+.5}},Quintic:{IN:function(n){return n*n*n*n*n},OUT:function(t){return 1-n.Quintic.IN(1-t)},IN_OUT:function(t){return t<.5?n.Quintic.IN(2*t)/2:n.Quintic.OUT(2*(t-.5))/2+.5}},Sine:{IN:function(n){return 1-Math.sin(1.5708*(1-n))},OUT:function(n){return Math.sin(1.5708*n)},IN_OUT:function(n){return(Math.cos(3.1416*n)-1)/-2}},Step:{IN:function(n){return 1!=n?0:1},OUT:function(n){return 1!=n?0:1},IN_OUT:function(n){return 1!=n?0:1}}};
},{}],"z1Y9":[function(require,module,exports) {
const{Rin:t,Class:i}=require("@rsthn/rin"),s=module.exports=i.extend({list:null,initialData:null,data:null,stack:null,block:null,time:0,blockTime:0,index:0,paused:!1,finished:!1,onFinishedCallback:null,__ctor:function(){this.list=[],this.initialData={},this.data={},this.stack=[],this.block=this.list,this.reset()},__dtor:function(){},clone:function(){var t=new s;return t.list=this.list,t.initialData=this.initialData,t.reset()},onFinished:function(t){return this.onFinishedCallback=t,this},reset:function(){for(var t in this.stack.length=0,this.blockTime=0,this.time=0,this.index=0,this.block=this.list,this.paused=!1,this.finished=!1,this.initialData)this.data[t]=this.initialData[t];return this},initial:function(t){return this.initialData=t,this.reset()},setOutput:function(t){return this.data=t,this},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(i){if(this.paused)return!1;if(this.index>=this.block.length)return!0;var s=0;for(this.time+=i;this.index<this.block.length;){var e,a=this.block[this.index];switch(a.op){case"parallel":if(0==a.started)for(a.blocks.length=0,a.started=!0,s=0;s<a.block.length;s++)a.blocks.push([a.block[s]]),a.indices[s]=0,a.blockTimes[s]=this.blockTime;var n=this.block,l=this.index,h=0,o=c=this.blockTime;for(s=0;s<a.blocks.length;s++)this.block=a.blocks[s],this.index=a.indices[s],this.blockTime=a.blockTimes[s],!0===this.update(0)&&h++,this.blockTime>o&&(o=this.blockTime),a.blockTimes[s]=this.blockTime,a.blocks[s]=this.block,a.indices[s]=this.index;if(this.block=n,this.index=l,this.blockTime=c,a.fn&&a.fn.call(this),h!=a.blocks.length)return!1;a.started=!1,this.blockTime=o,this.index++;break;case"serial":0==a.started&&(a._block=a.block,a._index=0,a._blockTime=this.blockTime,a.started=!0);n=this.block,l=this.index;var c=this.blockTime;if(this.block=a._block,this.index=a._index,this.blockTime=a._blockTime,s=this.update(0),a._block=this.block,a._index=this.index,a._blockTime=this.blockTime,this.block=n,this.index=l,this.blockTime=c,a.fn&&a.fn.call(this),!0!==s)return!1;a.started=!1,this.blockTime=a._blockTime,this.index++;break;case"repeat":0==a.started&&(a._block=a.block,a._index=0,a._blockTime=this.blockTime,a._count=a.count,a.started=!0);n=this.block,l=this.index,c=this.blockTime;return this.block=a._block,this.index=a._index,this.blockTime=a._blockTime,s=this.update(0),a._block=this.block,a._index=this.index,a._blockTime=this.blockTime,this.block=n,this.index=l,this.blockTime=c,a.fn&&a.fn.call(this),!0===s&&(a._count<=1?(a.started=!1,this.blockTime=a._blockTime,this.index++,!1):(a._index=0,a._count--,!1));case"set":this.data[a.field]=a.value,this.index++;break;case"restart":this.index=0;break;case"wait":if(e="string"==t.typeOf(a.duration)?this.data[a.duration]:a.duration,this.time<this.blockTime+e)return!1;this.blockTime+=e,this.index++;break;case"range":if(0==a.started&&(null===a.startValue?a._startValue=this.data[a.field]:a._startValue=a.startValue,a._endValue=a.endValue,a.started=!0),e="string"==t.typeOf(a.duration)?this.data[a.duration]:a.duration,i=this.time<this.blockTime+e?(this.time-this.blockTime)/e:1,a.easing&&1!=i?this.data[a.field]=a.easing(i)*(a._endValue-a._startValue)+a._startValue:this.data[a.field]=i*(a._endValue-a._startValue)+a._startValue,1!=i)return!1;a.started=!1,this.blockTime+=e,this.index++;break;case"rand":if(0==a.started&&(a.started=!0,a.last=null),e="string"==t.typeOf(a.duration)?this.data[a.duration]:a.duration,i=this.time<this.blockTime+e?(this.time-this.blockTime)/e:1,a.easing&&1!=i?a.cur=~~(a.easing(i)*a.count):a.cur=~~(i*a.count),a.cur!=a.last){for(;(s=~~(Math.random()*(a.endValue-a.startValue+1))+a.startValue)==this.data[a.field];);this.data[a.field]=s,a.last=a.cur}if(1!=i)return!1;a.started=!1,this.blockTime+=e,this.index++;break;case"randt":if(e="string"==t.typeOf(a.duration)?this.data[a.duration]:a.duration,i=this.time<this.blockTime+e?(this.time-this.blockTime)/e:1,s=a.easing&&1!=i?a.easing(i)*(a.count-1):i*(a.count-1),this.data[a.field]=a.table[~~((s+a.count)%a.count)],1!=i)return!1;this.blockTime+=e,this.index++;break;case"play":a.snd.play(),this.index++;break;case"exec":a.fn.call(this),this.index++}}return this.block==this.list&&(this.finished||null==this.onFinishedCallback||this.onFinishedCallback(),this.finished=!0),!0},parallel:function(){var t=[];return this.block.push({op:"parallel",started:!1,block:t,blocks:[],indices:[],blockTimes:[]}),this.stack.push(this.block),this.block=t,this},serial:function(){var t=[];return this.block.push({op:"serial",started:!1,block:t}),this.stack.push(this.block),this.block=t,this},repeat:function(t){var i=[];return this.block.push({op:"repeat",started:!1,block:i,count:t}),this.stack.push(this.block),this.block=i,this},callback:function(t){var i=this.stack[this.stack.length-1];return i[i.length-1].fn=t,this},end:function(){return this.block=this.stack.pop(),this},set:function(t,i){return this.block.push({op:"set",field:t,value:i}),this},restart:function(t){return this.block.push({op:"restart"}),this},wait:function(t){return this.block.push({op:"wait",duration:t}),this},range:function(t,i,s,e,a){return this.block.push({op:"range",started:!1,field:t,duration:i,startValue:s,endValue:e,easing:a||null}),this},rand:function(t,i,s,e,a,n){return this.block.push({op:"rand",started:!1,field:t,duration:i,count:s,startValue:e,endValue:a,easing:n||null}),this},randt:function(t,i,s,e,a,n){for(var l=[],h=0;h<s;h++)l.push(h%(a-e+1)+e);for(h=s>>2;h>0;h--){var o=~~(Math.random()*s),c=~~(Math.random()*s),r=l[c];l[c]=l[o],l[o]=r}return this.block.push({op:"randt",field:t,duration:i,count:s,startValue:e,endValue:a,table:l,easing:n||null}),this},play:function(t){return this.block.push({op:"play",snd:t}),this},exec:function(t){return this.block.push({op:"exec",fn:t}),this}});
},{"@rsthn/rin":"OHwo"}],"pW77":[function(require,module,exports) {
const{Class:s}=require("@rsthn/rin"),t=require("../controls"),i=require("../rect");module.exports=s.extend({bounds:null,hbounds:null,focusLock:!1,visible:!0,refX:0,refY:0,offsX:0,offsY:0,status:0,pstatus:0,unpressedImg:null,pressedImg:null,__ctor:function(s,n,e,h,u,o){this.unpressedImg=u,this.pressedImg=o;var r=t.getXByRef(this.refX=s),a=t.getYByRef(this.refY=n);e=(1&s?-1:1)*(this.offsX=e),h=(1&n?-1:1)*(this.offsY=h),r+=t.getFByRef(this.refX)*u.width+e,a+=t.getFByRef(this.refY)*u.height+h,this.bounds=i.alloc(this.unpressedImg.width,this.unpressedImg.height),this.bounds.translate(r-this.bounds.x1,a-this.bounds.y1),this.hbounds=i.alloc(),this.hbounds.set(this.bounds)},containsPoint:function(s,t){return 1==this.visible&&this.hbounds.containsPoint(s,t)},draw:function(s){this.visible&&(this.preDraw(s),this.status?this.pressedImg?this.pressedImg.draw(s,this.bounds.x1,this.bounds.y1):(s.pushMatrix(),s.translate(this.bounds.cx,this.bounds.cy),s.scale(.8,.8),this.unpressedImg.draw(s,.5*-this.unpressedImg.width,.5*-this.unpressedImg.height),s.popMatrix()):this.unpressedImg.draw(s,this.bounds.x1,this.bounds.y1),this.postDraw(s))},preDraw:function(s){},postDraw:function(s){},activate:function(s){s._ref=this,this.pstatus=this.status,this.status=1,this.onChange(this.status,this.pstatus)},deactivate:function(s){s._ref=null,this.pstatus=this.status,this.status=0,this.onChange(this.status,this.pstatus)},update:function(s,t){},reset:function(){this.status=this.pstatus=0,this.onChange(this.status,this.pstatus)},onChange:function(s,t){0==s&&1==t&&this.onTap()},onTap:function(){}});
},{"@rsthn/rin":"OHwo","../controls":"U0wU","../rect":"Z3Eu"}],"VAGi":[function(require,module,exports) {
const{Class:i}=require("@rsthn/rin"),s=require("../controls"),t=require("../rect");module.exports=i.extend({bounds:null,focusLock:!0,visible:!0,refX:0,refY:0,offsX:0,offsY:0,dispX:0,dispY:0,angle:0,radius:0,angleSteps:0,radiusSteps:0,rdirX:0,rdirY:0,dirX:0,dirY:0,magnitude:0,outerImg:null,innerImg:null,maxRadius:0,__ctor:function(i,h,a,n,r,d,e){this.maxRadius=e*r.width*.5,this.outerImg=r,this.innerImg=d;var u=s.getXByRef(this.refX=i),o=s.getYByRef(this.refY=h);a=(1&i?-1:1)*(this.offsX=a),n=(1&h?-1:1)*(this.offsY=n),u+=s.getFByRef(this.refX)*r.width+a,o+=s.getFByRef(this.refY)*r.height+n,this.bounds=t.alloc(this.outerImg.width,this.outerImg.height),this.bounds.translate(u-this.bounds.x1,o-this.bounds.y1)},containsPoint:function(i,s){return 1==this.visible&&this.bounds.containsPoint(i,s)},draw:function(i){if(this.visible){var s=this.bounds.x1,t=this.bounds.y1;this.outerImg.draw(i,s,t),this.innerImg.draw(i,this.bounds.cx-.5*this.innerImg.width+this.dispX,this.bounds.cy-.5*this.innerImg.height+this.dispY)}},activate:function(i){i._ref=this},deactivate:function(i){i._ref=null,this.reset()},update:function(i,s){var t=i-this.bounds.cx,h=s-this.bounds.cy;if(this.angle=Math.atan2(-h,t),this.radius=Math.sqrt(t*t+h*h),this.radius>this.maxRadius&&(this.radius=this.maxRadius),this.angleSteps){var a=2*Math.PI/this.angleSteps;this.angle=int((this.angle+Math.PI+a/2)/a)*a-Math.PI}if(this.radiusSteps){a=this.maxRadius/this.radiusSteps;this.radius=int((this.radius+a/2)/a)*a}this.rdirX=Math.min(1,Math.max(t/this.maxRadius,-1)),this.rdirY=Math.min(1,Math.max(h/this.maxRadius,-1)),this.dispX=this.radius*Math.cos(this.angle),this.dispY=this.radius*-Math.sin(this.angle),this.radius>0?(this.dirX=this.dispX/this.radius,this.dirY=this.dispY/this.radius,this.magnitude=this.radius/this.maxRadius):(this.dirX=0,this.dirY=0,this.magnitude=0),this.onChange(this.dirX,this.dirY,this.magnitude,this.angle)},reset:function(){this.dispX=0,this.dispY=0,this.rdirX=0,this.rdirY=0,this.dirX=0,this.dirY=0,this.magnitude=0,this.onChange(this.dirX,this.dirY,this.magnitude,this.angle)},onChange:function(i,s,t,h){}});
},{"@rsthn/rin":"OHwo","../controls":"U0wU","../rect":"Z3Eu"}],"U0wU":[function(require,module,exports) {
const e=require("./system");module.exports={LEFT:0,RIGHT:1,TOP:0,BOTTOM:1,CENTER:2,getXByRef:function(t){return t==this.CENTER?.5*e.screenWidth:t==this.LEFT?0:e.screenWidth-1},getYByRef:function(t){return t==this.CENTER?.5*e.screenHeight:t==this.TOP?0:e.screenHeight-1},getFByRef:function(e){return e==this.CENTER?-.5:1&e?-1:0}},module.exports.Button=require("./controls/button"),module.exports.Stick=require("./controls/stick");
},{"./system":"mu8O","./controls/button":"pW77","./controls/stick":"VAGi"}],"dZ5f":[function(require,module,exports) {
module.exports={G:require("./globals"),C:require("./config"),Matrix:require("./matrix"),Rect:require("./rect"),Vec2:require("./vec2"),TFunction:require("./tfunction"),Perf:require("./perf"),Log:require("./log"),Timer:require("./timer"),Recycler:require("./recycler"),Linkable:require("./linkable"),List:require("./list"),Canvas:require("./canvas"),KeyCodes:require("./keycodes"),System:require("./system"),Wrappers:require("./wrappers"),Resources:require("./resources"),QuadTreeItem:require("./quadtree-item"),QuadTreeNode:require("./quadtree-node"),QuadTree:require("./quadtree"),DisplayElement:require("./display-element"),Viewport:require("./viewport"),World:require("./world"),Easing:require("./easing"),Anim:require("./anim"),Controls:require("./controls")};
},{"./globals":"JxzF","./config":"L4Ts","./matrix":"vOmO","./rect":"Z3Eu","./vec2":"N2CI","./tfunction":"aqx4","./perf":"no3j","./log":"eRAA","./timer":"mNIK","./recycler":"nZpH","./linkable":"E606","./list":"LwHP","./canvas":"iBRc","./keycodes":"a5Xg","./system":"mu8O","./wrappers":"xNuh","./resources":"UcYf","./quadtree-item":"KwpD","./quadtree-node":"Ygob","./quadtree":"lu8c","./display-element":"JBY7","./viewport":"Z0pF","./world":"XEkr","./easing":"DjYU","./anim":"z1Y9","./controls":"U0wU"}],"epB2":[function(require,module,exports) {
var global = arguments[3];
var r=arguments[3];const{System:i}=require("@rsthn/cherry");r.main=function(){i.init({background:"#114",fullscreen:!1});const r={x:10,y:10,radius:16,dx:3,dy:2,color:"red"},d={x:50,y:10,radius:16,dx:-5,dy:3,color:"green"},e={x:10,y:50,radius:16,dx:7,dy:-5,color:"blue"};i.queueAdd({updateCircle:function(r,d){r.x+=r.dx,r.y+=r.dy,r.x-r.radius<0&&(r.x=0+r.radius,r.dx*=-1),r.y-r.radius<0&&(r.y=0+r.radius,r.dy*=-1),r.x+r.radius>i.screenWidth&&(r.x=i.screenWidth-r.radius,r.dx*=-1),r.y+r.radius>i.screenHeight&&(r.y=i.screenHeight-r.radius,r.dy*=-1)},drawCircle:function(r,i){i.beginPath(),i.circle(r.x,r.y,r.radius),i.fill(r.color)},update:function(i){this.updateCircle(r,i),this.updateCircle(d,i),this.updateCircle(e,i)},draw:function(i){i.clear(),this.drawCircle(r,i),this.drawCircle(d,i),this.drawCircle(e,i)}}),i.start()};
},{"@rsthn/cherry":"dZ5f"}]},{},["epB2"], null)
//# sourceMappingURL=/bundle.js.map